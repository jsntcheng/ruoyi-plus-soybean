import{aV as $,I as A,a as E,$ as m,q as F,am as O,l as H,ac as U,r as v,ar as V}from"./index-Z8DUt18u.js";import{u as W}from"./use-table-DjHicHPt.js";function L(c){const r=$(),g=A(),i=E(()=>g.isMobile),{apiFn:k,apiParams:p,immediate:w,showTotal:u=!0}=c,f="__selection__",l="__expand__",{loading:C,empty:z,data:o,columns:b,columnChecks:x,reloadColumns:h,getData:y,searchParams:d,updateSearchParams:S,resetSearchParams:N}=W({apiFn:k,apiParams:p,columns:c.columns,transformer:e=>{const{rows:n=[],total:t=0}=e.data||{},_=d.pageNum,a=d.pageSize||0,D=a<=0?10:a;return{data:n.map((K,M)=>({...K,index:(_-1)*D+M+1})),pageNum:_,pageSize:D,total:t}},getColumnChecks:e=>{const n=[];return e.forEach(t=>{T(t)?n.push({key:t.key,title:t.title,checked:!0}):t.type==="selection"?n.push({key:f,title:m("common.check"),checked:!0}):t.type==="expand"&&n.push({key:l,title:m("common.expandColumn"),checked:!0})}),n},getColumns:(e,n)=>{const t=new Map;return e.forEach(a=>{T(a)?t.set(a.key,a):a.type==="selection"?t.set(f,a):a.type==="expand"&&t.set(l,a)}),n.filter(a=>a.checked).map(a=>t.get(a.key))},onFetched:async e=>{const{total:n}=e;P({page:d.pageNum,pageSize:d.pageSize,itemCount:n})},immediate:w}),s=F({page:1,pageSize:10,showSizePicker:!0,itemCount:0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{s.page=e,S({pageNum:e,pageSize:s.pageSize}),y()},onUpdatePageSize:async e=>{s.pageSize=e,s.page=1,S({pageNum:s.page,pageSize:e}),y()},...u?{prefix:e=>m("datatable.itemCount",{total:e.itemCount})}:{}}),I=E(()=>({...s,pageSlot:i.value?3:9,prefix:!i.value&&u?s.prefix:void 0}));function P(e){Object.assign(s,e)}async function B(e=1){P({page:e}),S({pageNum:e,pageSize:s.pageSize}),await y()}return r.run(()=>{O(()=>g.locale,()=>{h()})}),H(()=>{r.stop()}),{loading:C,empty:z,data:o,columns:b,columnChecks:x,reloadColumns:h,pagination:s,mobilePagination:I,updatePagination:P,getData:y,getDataByPage:B,searchParams:d,updateSearchParams:S,resetSearchParams:N}}function R(c,r){const{bool:g,setTrue:i,setFalse:k}=U(),p=v("add");function w(){p.value="add",i()}const u=v(null);function f(o,b){p.value="edit";const x=c.value.find(h=>h[o]===b)||null;u.value=V(x),i()}const l=v([]);async function C(){var o;(o=window.$message)==null||o.success(m("common.deleteSuccess")),l.value=[],await r()}async function z(){var o;(o=window.$message)==null||o.success(m("common.deleteSuccess")),await r()}return{drawerVisible:g,openDrawer:i,closeDrawer:k,operateType:p,handleAdd:w,editingData:u,handleEdit:f,checkedRowKeys:l,onBatchDeleted:C,onDeleted:z}}function T(c){return!!c.key}export{R as a,L as u};
