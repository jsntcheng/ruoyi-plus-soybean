import{_ as Z,a as ee,b as ie}from"./dept-tree-select.vue_vue_type_script_setup_true_lang-BO9JZ0Qq.js";import{_ as ue,a as pe,b as me}from"./round-refresh-B0IUvXWI.js";import{u as ce,a as _e,_ as fe,b as ve}from"./tree-table-mVvdnsbE.js";import{aj as V,d as H,ak as O,al as te,a as Q,q as he,am as be,c as j,o as q,w as n,f as e,an as we,v as ne,B as J,g as R,t as z,h as t,$ as _,ap as ye,R as oe,I as Ie,b as ge,af as F,s as X,a3 as ke,aq as xe,A as G,ar as Ne}from"./index-Z8DUt18u.js";import{_ as De,a as Ce,b as Te,u as Se}from"./auth-CEy-eMOu.js";import{u as Re}from"./download-4Fcgw4rI.js";import{u as ae,a as Ue,b as le,_ as $e}from"./form-34oM_FHm.js";import{_ as se}from"./TreeSelect-N4Gm5Bfd.js";import{_ as re}from"./Space-CCrTpFrl.js";import{_ as Be}from"./Grid-tUpxGiRj.js";import"./DataTable-s6EYq0ve.js";import"./user-BD5iFoP8.js";import"./dept-CPxOIfHF.js";import"./use-table-DjHicHPt.js";import"./Tree-C1TOTihx.js";function Ae(u){return V({url:"/demo/tree/list",method:"get",params:u})}function Fe(u){return V({url:"/demo/tree",method:"post",data:u})}function qe(u){return V({url:"/demo/tree",method:"put",data:u})}function Y(u){return V({url:`/demo/tree/${u.join(",")}`,method:"delete"})}const Me=H({name:"TreeOperateDrawer",__name:"tree-operate-drawer",props:O({operateType:{},rowData:{},treeList:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(u,{emit:U}){const d=u,h=U,b=te(u,"visible"),{formRef:N,validate:l,restoreValidation:k}=ae(),{createRequiredRule:f}=Ue(),w=Q(()=>({add:"新增测试树",edit:"编辑测试树"})[d.operateType]),a=he(x());function x(){return{parentId:null,deptId:null,userId:null,treeName:""}}const v={id:f("主键不能为空"),parentId:f("父 ID 不能为空"),deptId:f("部门不能为空"),userId:f("用户不能为空"),treeName:f("值不能为空")};function $(){var p;if(d.operateType==="add"){Object.assign(a,x()),a.parentId=((p=d.rowData)==null?void 0:p.id)||0;return}d.operateType==="edit"&&d.rowData&&Object.assign(a,d.rowData)}function T(){b.value=!1}async function D(){var p;if(await l(),d.operateType==="add"){const{parentId:s,deptId:y,userId:r,treeName:I}=a,{error:g}=await Fe({parentId:s,deptId:y,userId:r,treeName:I});if(g)return}if(d.operateType==="edit"){const{id:s,parentId:y,deptId:r,userId:I,treeName:g}=a,{error:C}=await qe({id:s,parentId:y,deptId:r,userId:I,treeName:g});if(C)return}(p=window.$message)==null||p.success(_("common.updateSuccess")),T(),h("submitted")}be(b,()=>{b.value&&($(),k())});const B=Q(()=>[{id:0,treeName:"顶级节点",children:d.treeList}]);return(p,s)=>{const y=se,r=$e,I=Z,g=ee,C=ne,A=le,m=J,W=re,E=we,i=ye;return q(),j(i,{show:b.value,"onUpdate:show":s[4]||(s[4]=o=>b.value=o),title:w.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:n(()=>[e(E,{title:w.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(W,{size:16},{default:n(()=>[e(m,{onClick:T},{default:n(()=>[R(z(t(_)("common.cancel")),1)]),_:1}),e(m,{type:"primary",onClick:D},{default:n(()=>[R(z(t(_)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(A,{ref_key:"formRef",ref:N,model:a,rules:v},{default:n(()=>[e(r,{label:"父 ID",path:"parentId"},{default:n(()=>[e(y,{value:a.parentId,"onUpdate:value":s[0]||(s[0]=o=>a.parentId=o),filterable:"",class:"h-full","key-field":"id","label-field":"treeName",options:B.value,"default-expanded-keys":[0]},null,8,["value","options"])]),_:1}),e(r,{label:"部门",path:"deptId"},{default:n(()=>[e(I,{value:a.deptId,"onUpdate:value":s[1]||(s[1]=o=>a.deptId=o),placeholder:"请选择部门"},null,8,["value"])]),_:1}),e(r,{label:"用户",path:"userId"},{default:n(()=>[e(g,{value:a.userId,"onUpdate:value":s[2]||(s[2]=o=>a.userId=o),placeholder:"请选择用户"},null,8,["value"])]),_:1}),e(r,{label:"值",path:"treeName"},{default:n(()=>[e(C,{value:a.treeName,"onUpdate:value":s[3]||(s[3]=o=>a.treeName=o),placeholder:"请输入值"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),Oe=H({name:"TreeSearch",__name:"tree-search",props:O({treeList:{}},{model:{required:!0},modelModifiers:{}}),emits:O(["reset","search"],["update:model"]),setup(u,{emit:U}){const d=U,{formRef:h,validate:b,restoreValidation:N}=ae(),l=te(u,"model");async function k(){Object.assign(l.value.params,{}),await N(),d("reset")}async function f(){await b(),d("search")}return(w,a)=>{const x=se,v=Te,$=Z,T=ee,D=ne,B=ue,p=J,s=pe,y=re,r=Be,I=le,g=Ce,C=De,A=oe;return q(),j(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(C,null,{default:n(()=>[e(g,{title:t(_)("common.search"),name:"user-search"},{default:n(()=>[e(I,{ref_key:"formRef",ref:h,model:l.value,"label-placement":"left","label-width":80},{default:n(()=>[e(r,{responsive:"screen","item-responsive":""},{default:n(()=>[e(v,{span:"24 s:12 m:6",label:"父 ID",path:"parentId",class:"pr-24px"},{default:n(()=>[e(x,{value:l.value.parentId,"onUpdate:value":a[0]||(a[0]=m=>l.value.parentId=m),filterable:"",class:"h-full","key-field":"id","label-field":"treeName",options:w.treeList,"default-expanded-keys":[0]},null,8,["value","options"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"部门",path:"deptId",class:"pr-24px"},{default:n(()=>[e($,{value:l.value.deptId,"onUpdate:value":a[1]||(a[1]=m=>l.value.deptId=m),placeholder:"请选择部门"},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"用户",path:"userId",class:"pr-24px"},{default:n(()=>[e(T,{value:l.value.userId,"onUpdate:value":a[2]||(a[2]=m=>l.value.userId=m),placeholder:"请选择用户"},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"值",path:"treeName",class:"pr-24px"},{default:n(()=>[e(D,{value:l.value.treeName,"onUpdate:value":a[3]||(a[3]=m=>l.value.treeName=m),placeholder:"请输入值"},null,8,["value"])]),_:1}),e(v,{"show-feedback":!1,span:"24",class:"pr-24px"},{default:n(()=>[e(y,{class:"w-full",justify:"end"},{default:n(()=>[e(p,{onClick:k},{icon:n(()=>[e(B,{class:"text-icon"})]),default:n(()=>[R(" "+z(t(_)("common.reset")),1)]),_:1}),e(p,{type:"primary",ghost:"",onClick:f},{icon:n(()=>[e(s,{class:"text-icon"})]),default:n(()=>[R(" "+z(t(_)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},tt=H({name:"demo_tree",__name:"index",setup(u){const U=Ie(),{download:d}=Re(),{hasAuth:h}=Se(),{columns:b,columnChecks:N,data:l,getData:k,loading:f,searchParams:w,resetSearchParams:a,expandedRowKeys:x,isCollapse:v,expandAll:$,collapseAll:T}=ce({apiFn:Ae,apiParams:{pageNum:1,pageSize:10,parentId:null,deptId:null,userId:null,treeName:null,params:{}},idField:"id",columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"主键",align:"center",minWidth:120},{key:"parentId",title:"父 ID",align:"center",minWidth:120},{key:"deptId",title:"部门 ID",align:"center",minWidth:120},{key:"userId",title:"用户 ID",align:"center",minWidth:120},{key:"treeName",title:"值",align:"center",minWidth:120},{key:"operate",title:_("common.operate"),align:"center",width:130,render:i=>{const o=()=>e(G,{text:!0,type:"primary",icon:"material-symbols:add-2-rounded",tooltipContent:_("common.add"),onClick:()=>W(i)},null),L=()=>e(G,{text:!0,type:"primary",icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:_("common.edit"),onClick:()=>m(i)},null),M=()=>e(G,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:_("common.delete"),popconfirmContent:_("common.confirmDelete"),onPositiveClick:()=>A(i.id)},null),S=[];return h("demo:tree:add")&&S.push(o()),h("demo:tree:edit")&&S.push(L()),h("demo:tree:remove")&&S.push(M()),e("div",{class:"flex-center gap-8px"},[S.map((K,P)=>e(ke,null,[P!==0&&e(xe,{vertical:!0},null),K]))])}}]}),{drawerVisible:D,operateType:B,editingData:p,handleAdd:s,handleEdit:y,checkedRowKeys:r,onBatchDeleted:I,onDeleted:g}=_e(l,k);async function C(){const{error:i}=await Y(r.value);i||I()}async function A(i){const{error:o}=await Y([i]);o||g()}async function m(i){y(i)}function W(i){p.value=Ne(i),s()}function E(){d("/demo/tree/export",w,`demo_tree_#[[${new Date().getTime()}]]#.xlsx`)}return(i,o)=>{const L=fe,M=J,S=ve,K=me,P=ie,de=oe;return q(),ge("div",je,[e(Oe,{model:t(w),"onUpdate:model":o[0]||(o[0]=c=>F(w)?w.value=c:null),"tree-list":t(l),onReset:t(a),onSearch:t(k)},null,8,["model","tree-list","onReset","onSearch"]),e(de,{title:"测试树列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(K,{columns:t(N),"onUpdate:columns":o[1]||(o[1]=c=>F(N)?N.value=c:null),"disabled-delete":t(r).length===0,loading:t(f),"show-add":t(h)("demo:tree:add"),"show-delete":t(h)("demo:tree:remove"),"show-export":!1,onAdd:t(s),onDelete:C,onExport:E,onRefresh:t(k)},{prefix:n(()=>[t(v)?X("",!0):(q(),j(M,{key:0,disabled:!t(l).length,size:"small",onClick:t($)},{icon:n(()=>[e(L)]),default:n(()=>[o[5]||(o[5]=R(" 全部展开 "))]),_:1},8,["disabled","onClick"])),t(v)?(q(),j(M,{key:1,disabled:!t(l).length,size:"small",onClick:t(T)},{icon:n(()=>[e(S)]),default:n(()=>[o[6]||(o[6]=R(" 全部收起 "))]),_:1},8,["disabled","onClick"])):X("",!0)]),_:1},8,["columns","disabled-delete","loading","show-add","show-delete","onAdd","onRefresh"])]),default:n(()=>[e(P,{"checked-row-keys":t(r),"onUpdate:checkedRowKeys":o[2]||(o[2]=c=>F(r)?r.value=c:null),"expanded-row-keys":t(x),"onUpdate:expandedRowKeys":o[3]||(o[3]=c=>F(x)?x.value=c:null),columns:t(b),data:t(l),"flex-height":!t(U).isMobile,"scroll-x":962,loading:t(f),remote:"","row-key":c=>c.id,class:"sm:h-full"},null,8,["checked-row-keys","expanded-row-keys","columns","data","flex-height","loading","row-key"]),e(Me,{visible:t(D),"onUpdate:visible":o[4]||(o[4]=c=>F(D)?D.value=c:null),"operate-type":t(B),"row-data":t(p),"tree-list":t(l),onSubmitted:t(k)},null,8,["visible","operate-type","row-data","tree-list","onSubmitted"])]),_:1})])}}});export{tt as default};
