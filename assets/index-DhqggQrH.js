import{_ as ce,a as _e,b as fe}from"./round-refresh-B0IUvXWI.js";import{u as ge,a as ye,_ as ve,b as he}from"./tree-table-mVvdnsbE.js";import{d as te,ak as Z,al as oe,p as ae,r as K,$ as t,a as be,q as Ne,am as we,c as j,o as L,w as o,f as a,an as De,s as ee,h as e,v as le,ao as Ce,N as ne,B as Q,g as S,t as q,ap as xe,a$ as ke,R as se,I as Ie,b as Ue,af as J,a3 as $e,aq as Te,A as Y,ar as Re}from"./index-Z8DUt18u.js";import{a as Le,b as Se,c as de,d as qe,e as Be}from"./dept-CPxOIfHF.js";import{_ as Fe,a as Ae,b as Oe,u as ze}from"./auth-CEy-eMOu.js";import{u as re}from"./dict-D3hWHJVt.js";import{_ as Me}from"./dict-tag.vue_vue_type_script_setup_true_lang-C3NRfqiy.js";import{_ as Pe}from"./dict-radio.vue_vue_type_script_setup_true_lang-Chn5U5qK.js";import{d as Ve}from"./user-BD5iFoP8.js";import{u as pe,a as We,b as ie,_ as Ee}from"./form-34oM_FHm.js";import{_ as Ge}from"./TreeSelect-N4Gm5Bfd.js";import{_ as me}from"./Space-CCrTpFrl.js";import{_ as He}from"./Grid-tUpxGiRj.js";import{_ as je}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";import"./Tree-C1TOTihx.js";const Ke=te({name:"DeptOperateDrawer",__name:"dept-operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(B,{emit:F}){const s=B,A=F,f=oe(B,"visible"),{formRef:h,validate:c,restoreValidation:k}=pe(),{createRequiredRule:g,patternRules:I}=We(),{loading:U,startLoading:y,endLoading:O}=ae(),{loading:w,startLoading:D,endLoading:z}=ae(),v=K([]),C=K([]),x=K(t("page.system.dept.placeholder.defaultLeaderPlaceHolder")),b=K(!1),$=be(()=>({add:t("page.system.dept.addDept"),edit:t("page.system.dept.editDept")})[s.operateType]),n=Ne(T());function T(){return{parentId:"",deptName:"",deptCategory:"",orderNum:null,leader:null,phone:"",email:"",status:"0"}}const M={deptId:g(t("page.system.dept.form.deptId.invalid")),parentId:g(t("page.system.dept.form.parentId.invalid")),orderNum:g(t("page.system.dept.form.orderNum.invalid")),deptName:g(t("page.system.dept.form.deptName.invalid")),phone:I.phone,email:I.email};function r(){var i;s.operateType==="add"&&(Object.assign(n,T()),n.parentId=((i=s.rowData)==null?void 0:i.deptId)||0),s.operateType==="edit"&&s.rowData&&Object.assign(n,s.rowData)}function u(){f.value=!1}async function P(){var i;if(await c(),s.operateType==="add"){const{parentId:l,deptName:d,deptCategory:p,orderNum:_,leader:W,phone:E,email:G,status:R}=n,{error:H}=await Le({parentId:l,deptName:d,deptCategory:p,orderNum:_,leader:W,phone:E,email:G,status:R});if(H)return}if(s.operateType==="edit"){const{deptId:l,parentId:d,deptName:p,deptCategory:_,orderNum:W,leader:E,phone:G,email:R,status:H}=n,{error:X}=await Se({deptId:l,parentId:d,deptName:p,deptCategory:_,orderNum:W,leader:E,phone:G,email:R,status:H});if(X)return}(i=window.$message)==null||i.success(t("common.updateSuccess")),u(),A("submitted")}async function V(){var d,p;y();const{data:i,error:l}=s.operateType==="add"?await de():await qe((d=s.rowData)==null?void 0:d.deptId);if(l){(p=window.$message)==null||p.error(l.message||t("page.system.dept.error.getDeptDataFail"));return}i&&(v.value=ke(i,{idField:"deptId"})),O()}async function N(){var d,p;if(s.operateType==="add"||!((d=s.rowData)!=null&&d.deptId)){x.value=t("page.system.dept.placeholder.addDataLeaderPlaceHolder"),b.value=!0;return}D();const{data:i,error:l}=await Ve(s.rowData.deptId);if(l){(p=window.$message)==null||p.error(l.message||t("page.system.dept.error.getDeptUserDataFail"));return}i.length===0&&(x.value=t("page.system.dept.placeholder.deptUserIsEmptyLeaderPlaceHolder"),b.value=!0),C.value=i.map(_=>({label:`${_.userName} | ${_.nickName}`,value:_.userId})),z()}return we(f,()=>{f.value&&(b.value=!1,V(),N(),r(),k())}),(i,l)=>{const d=Ge,p=Ee,_=le,W=ne,E=Pe,G=ie,R=Q,H=me,X=De,ue=xe;return L(),j(ue,{show:f.value,"onUpdate:show":l[8]||(l[8]=m=>f.value=m),title:$.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:o(()=>[a(X,{title:$.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[a(H,{size:16},{default:o(()=>[a(R,{onClick:u},{default:o(()=>[S(q(e(t)("common.cancel")),1)]),_:1}),a(R,{type:"primary",onClick:P},{default:o(()=>[S(q(e(t)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(G,{ref_key:"formRef",ref:h,model:n,rules:M},{default:o(()=>[n.parentId!=0?(L(),j(p,{key:0,label:e(t)("page.system.dept.parentId"),path:"parentId"},{default:o(()=>[a(d,{value:n.parentId,"onUpdate:value":l[0]||(l[0]=m=>n.parentId=m),loading:e(U),clearable:"",options:v.value,"label-field":"deptName","key-field":"deptId","default-expand-all":"",placeholder:e(t)("page.system.dept.form.parentId.required")},null,8,["value","loading","options","placeholder"])]),_:1},8,["label"])):ee("",!0),a(p,{label:e(t)("page.system.dept.deptName"),path:"deptName"},{default:o(()=>[a(_,{value:n.deptName,"onUpdate:value":l[1]||(l[1]=m=>n.deptName=m),placeholder:e(t)("page.system.dept.form.deptName.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.orderNum"),path:"orderNum"},{default:o(()=>[a(e(Ce),{value:n.orderNum,"onUpdate:value":l[2]||(l[2]=m=>n.orderNum=m),class:"w-full",placeholder:e(t)("page.system.dept.form.orderNum.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.deptCategory"),path:"deptCategory"},{default:o(()=>[a(_,{value:n.deptCategory,"onUpdate:value":l[3]||(l[3]=m=>n.deptCategory=m),placeholder:e(t)("page.system.dept.form.deptCategory.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.leader"),path:"leader"},{default:o(()=>[a(W,{value:n.leader,"onUpdate:value":l[4]||(l[4]=m=>n.leader=m),loading:e(w),disabled:b.value,placeholder:x.value,options:C.value},null,8,["value","loading","disabled","placeholder","options"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.phone"),path:"phone"},{default:o(()=>[a(_,{value:n.phone,"onUpdate:value":l[5]||(l[5]=m=>n.phone=m),placeholder:e(t)("page.system.dept.form.phone.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.email"),path:"email"},{default:o(()=>[a(_,{value:n.email,"onUpdate:value":l[6]||(l[6]=m=>n.email=m),placeholder:e(t)("page.system.dept.form.email.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(t)("page.system.dept.status"),path:"status"},{default:o(()=>[a(E,{value:n.status,"onUpdate:value":l[7]||(l[7]=m=>n.status=m),"dict-code":"sys_normal_disable"},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),Je=te({name:"DeptSearch",__name:"dept-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(B,{emit:F}){const s=F,{formRef:A,validate:f,restoreValidation:h}=pe(),c=oe(B,"model"),{options:k}=re("sys_normal_disable");async function g(){await h(),s("reset")}async function I(){await f(),s("search")}return(U,y)=>{const O=le,w=Oe,D=ne,z=ce,v=Q,C=_e,x=me,b=He,$=ie,n=Ae,T=Fe,M=se;return L(),j(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(T,null,{default:o(()=>[a(n,{title:e(t)("common.search"),name:"user-search"},{default:o(()=>[a($,{ref_key:"formRef",ref:A,model:c.value,"label-placement":"left","label-width":80},{default:o(()=>[a(b,{responsive:"screen","item-responsive":""},{default:o(()=>[a(w,{span:"8",label:e(t)("page.system.dept.deptName"),path:"deptName",class:"pr-24px"},{default:o(()=>[a(O,{value:c.value.deptName,"onUpdate:value":y[0]||(y[0]=r=>c.value.deptName=r),placeholder:e(t)("page.system.dept.form.deptName.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(w,{span:"8 ",label:e(t)("page.system.dept.status"),path:"status",class:"pr-24px"},{default:o(()=>[a(D,{value:c.value.status,"onUpdate:value":y[1]||(y[1]=r=>c.value.status=r),placeholder:e(t)("page.system.dept.form.status.required"),options:e(k),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(w,{span:"8",class:"pr-24px"},{default:o(()=>[a(x,{class:"w-full",justify:"end"},{default:o(()=>[a(v,{onClick:g},{icon:o(()=>[a(z,{class:"text-icon"})]),default:o(()=>[S(" "+q(e(t)("common.reset")),1)]),_:1}),a(v,{type:"primary",ghost:"",onClick:I},{icon:o(()=>[a(C,{class:"text-icon"})]),default:o(()=>[S(" "+q(e(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},_t=te({name:"system_dept",__name:"index",setup(B){re("sys_normal_disable");const F=Ie(),{hasAuth:s}=ze(),{columns:A,columnChecks:f,data:h,getData:c,loading:k,searchParams:g,resetSearchParams:I,expandedRowKeys:U,isCollapse:y,expandAll:O,collapseAll:w}=ge({apiFn:de,apiParams:{deptName:null,status:null},idField:"deptId",columns:()=>[{key:"deptName",title:t("page.system.dept.deptName"),align:"center",minWidth:120},{key:"deptCategory",title:t("page.system.dept.deptCategory"),align:"center",minWidth:120},{key:"orderNum",title:t("page.system.dept.sort"),align:"center",minWidth:60},{key:"status",title:t("page.system.dept.status"),align:"center",minWidth:120,render(r){return a(Me,{size:"small",value:r.status,dictCode:"sys_normal_disable"},null)}},{key:"createTime",title:t("page.system.dept.createTime"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:150,render:r=>{const u=()=>a(Y,{text:!0,type:"primary",icon:"material-symbols:add-2-rounded",tooltipContent:t("common.add"),onClick:()=>T(r)},null),P=()=>a(Y,{text:!0,type:"primary",icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:t("common.edit"),onClick:()=>n(r)},null),V=()=>a(Y,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:t("common.delete"),popconfirmContent:t("common.confirmDelete"),onPositiveClick:()=>$(r.deptId)},null),N=[];return s("system:dept:add")&&N.push(u()),s("system:dept:edit")&&N.push(P()),s("system:dept:remove")&&N.push(V()),a("div",{class:"flex-center gap-8px"},[N.map((i,l)=>a($e,null,[l!==0&&a(Te,{vertical:!0},null),i]))])}}]}),{drawerVisible:D,operateType:z,editingData:v,handleAdd:C,handleEdit:x,onDeleted:b}=ye(h,c);async function $(r){const{error:u}=await Be([r]);u||b()}async function n(r){x(r)}async function T(r){v.value=Re(r),C()}async function M(){v.value=null,C()}return(r,u)=>{const P=ve,V=he,N=fe,i=je,l=se;return L(),Ue("div",Qe,[a(Je,{model:e(g),"onUpdate:model":u[0]||(u[0]=d=>J(g)?g.value=d:null),onReset:e(I),onSearch:e(c)},null,8,["model","onReset","onSearch"]),a(l,{title:e(t)("page.system.dept.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[a(N,{columns:e(f),"onUpdate:columns":u[1]||(u[1]=d=>J(f)?f.value=d:null),loading:e(k),"show-add":e(s)("system:dept:add"),"show-delete":!1,onAdd:M,onRefresh:e(c)},{prefix:o(()=>[e(y)?ee("",!0):(L(),j(e(Q),{key:0,disabled:!e(h).length,size:"small",onClick:e(O)},{icon:o(()=>[a(P)]),default:o(()=>[S(" "+q(e(t)("page.system.dept.expandAll")),1)]),_:1},8,["disabled","onClick"])),e(y)?(L(),j(e(Q),{key:1,disabled:!e(h).length,size:"small",onClick:e(w)},{icon:o(()=>[a(V)]),default:o(()=>[S(" "+q(e(t)("page.system.dept.collapseAll")),1)]),_:1},8,["disabled","onClick"])):ee("",!0)]),_:1},8,["columns","loading","show-add","onRefresh"])]),default:o(()=>[a(i,{"expanded-row-keys":e(U),"onUpdate:expandedRowKeys":u[2]||(u[2]=d=>J(U)?U.value=d:null),columns:e(A),data:e(h),size:"small",indent:32,"flex-height":!e(F).isMobile,"scroll-x":962,loading:e(k),"row-key":d=>d.deptId,class:"sm:h-full"},null,8,["expanded-row-keys","columns","data","flex-height","loading","row-key"]),a(Ke,{visible:e(D),"onUpdate:visible":u[3]||(u[3]=d=>J(D)?D.value=d:null),"operate-type":e(z),"row-data":e(v),onSubmitted:e(c)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{_t as default};
