import{_ as ve,a as ye,b as ge}from"./round-refresh-B0IUvXWI.js";import{bt as he,bu as be,aj as q,am as M,d as $,bv as we,r as H,aP as W,i as Ce,bw as ae,j as ke,bx as Se,a1 as X,ak as O,al as G,by as Te,a as V,as as De,b as ie,o as L,f as o,h as i,x as Ne,w as d,c as J,s as xe,aa as Ee,bz as Be,I as re,J as Ae,bA as Ie,bB as Pe,q as Re,an as Ue,v as le,B as se,g as j,t as F,$ as P,ap as Ve,R as ue,af as z,aq as Me,A as Y}from"./index-Z8DUt18u.js";import{_ as Oe,a as Le,b as $e,u as ze}from"./auth-CEy-eMOu.js";import{u as je,a as Fe}from"./table-xLscuIQ4.js";import{u as Q}from"./dict-D3hWHJVt.js";import{_ as Z}from"./dict-tag.vue_vue_type_script_setup_true_lang-C3NRfqiy.js";import{_ as qe}from"./dict-radio.vue_vue_type_script_setup_true_lang-Chn5U5qK.js";import{c as Ke}from"./_createCompounder-DoywBD48.js";import{u as ce,a as He,b as de,_ as We}from"./form-34oM_FHm.js";import{_ as me}from"./Space-CCrTpFrl.js";import{_ as Ge}from"./dict-select.vue_vue_type_script_setup_true_lang-B4-DraB3.js";import{_ as Je}from"./Grid-tUpxGiRj.js";import{_ as Xe}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";function Ye(e){return he(be(e).toLowerCase())}var Qe=Ke(function(e,n,t){return n=n.toLowerCase(),e+(t?Ye(n):n)});function Ze(e){return q({url:"/system/notice/list",method:"get",params:e})}function et(e){return q({url:"/system/notice",method:"post",data:e})}function tt(e){return q({url:"/system/notice",method:"put",data:e})}function ee(e){return q({url:`/system/notice/${e.join(",")}`,method:"delete"})}var nt=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],ot=function(e){return nt.map(function(n){return n.toLowerCase()}).indexOf(e.toLowerCase())!==-1},at=function(e,n,t){Object.keys(n).filter(ot).forEach(function(l){var a=n[l];typeof a=="function"&&(l==="onInit"?a(e,t):t.on(l.substring(2),function(s){return a(s,t)}))})},it=function(e,n,t,l){var a=e.modelEvents?e.modelEvents:null,s=Array.isArray(a)?a.join(" "):a;M(l,function(m,f){t&&typeof m=="string"&&m!==f&&m!==t.getContent({format:e.outputFormat})&&t.setContent(m)}),t.on(s||"change input undo redo",function(){n.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},rt=function(e,n,t,l,a,s){l.setContent(s()),t.attrs["onUpdate:modelValue"]&&it(n,t,l,a),at(e,t.attrs,l)},te=0,pe=function(e){var n=Date.now(),t=Math.floor(Math.random()*1e9);return te++,e+"_"+t+te+String(n)},lt=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},ne=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},st=function(e,n){return ne(e).concat(ne(n))},ut=function(e){return e==null},oe=function(){return{listeners:[],scriptId:pe("tiny-script"),scriptLoaded:!1}},ct=function(){var e=oe(),n=function(a,s,m,f){var r=s.createElement("script");r.referrerPolicy="origin",r.type="application/javascript",r.id=a,r.src=m;var E=function(){r.removeEventListener("load",E),f()};r.addEventListener("load",E),s.head&&s.head.appendChild(r)},t=function(a,s,m){e.scriptLoaded?m():(e.listeners.push(m),a.getElementById(e.scriptId)||n(e.scriptId,a,s,function(){e.listeners.forEach(function(f){return f()}),e.scriptLoaded=!0}))},l=function(){e=oe()};return{load:t,reinitialize:l}},dt=ct(),mt=function(){return typeof window<"u"?window:global},U=function(){var e=mt();return e&&e.tinymce?e.tinymce:null},pt={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},I=function(){return I=Object.assign||function(e){for(var n,t=1,l=arguments.length;t<l;t++){n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)},ft=function(e,n,t,l){return e(l||"div",{id:n,ref:t})},_t=function(e,n,t){return e("textarea",{id:n,visibility:"hidden",ref:t})},K={selector:void 0,target:void 0},vt=$({props:pt,setup:function(e,n){var t=e.init?I(I({},e.init),K):I({},K),l=we(e),a=l.disabled,s=l.modelValue,m=l.tagName,f=H(null),r=null,E=e.id||pe("tiny-vue"),C=e.init&&e.init.inline||e.inline,A=!!n.attrs["onUpdate:modelValue"],T=!0,N=e.initialValue?e.initialValue:"",D="",v=function(c){return A?function(){return s!=null&&s.value?s.value:""}:function(){return c?N:D}},g=function(){var c=v(T),p=I(I({},t),{readonly:e.disabled,target:f.value,plugins:st(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:C,license_key:e.licenseKey,setup:function(k){r=k,k.on("init",function(B){return rt(B,e,n,k,s,c)}),typeof t.setup=="function"&&t.setup(k)}});lt(f.value)&&(f.value.style.visibility=""),U().init(p),T=!1};M(a,function(c){var p;r!==null&&(typeof((p=r.mode)===null||p===void 0?void 0:p.set)=="function"?r.mode.set(c?"readonly":"design"):r.setMode(c?"readonly":"design"))}),M(m,function(c){var p;A||(D=r.getContent()),(p=U())===null||p===void 0||p.remove(r),W(function(){return g()})}),Ce(function(){if(U()!==null)g();else if(f.value&&f.value.ownerDocument){var c=e.cloudChannel?e.cloudChannel:"7",p=e.apiKey?e.apiKey:"no-api-key",k=ut(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(p,"/tinymce/").concat(c,"/tinymce.min.js"):e.tinymceScriptSrc;dt.load(f.value.ownerDocument,k,g)}}),ae(function(){U()!==null&&U().remove(r)}),C||(ke(function(){T||g()}),Se(function(){var c;A||(D=r.getContent()),(c=U())===null||c===void 0||c.remove(r)}));var h=function(c){var p;D=r.getContent(),(p=U())===null||p===void 0||p.remove(r),t=I(I(I({},t),c),K),W(function(){return g()})};return n.expose({rerender:h,getEditor:function(){return r}}),function(){return C?ft(X,E,f,e.tagName):_t(X,E,f)}}});const yt="preview importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor insertdatetime advlist lists wordcount help charmap emoticons accordion",gt="undo redo | accordion accordionremove | blocks fontfamily fontsize | bold italic underline strikethrough | align numlist bullist | link image | table media | lineheight outdent indent| forecolor backcolor removeformat | charmap emoticons | code fullscreen preview | save print | pagebreak anchor codesample | ltr rtl",ht={class:"app-tinymce w-full"},bt=$({name:"TinyMce",inheritAttrs:!1,__name:"tinymce",props:O({height:{default:400},options:{default:()=>({})},plugins:{default:yt},toolbar:{default:gt},disabled:{type:Boolean,default:!1},isDark:{type:Boolean,default:!1},locale:{default:"zh_CN"},uploadUrl:{},uploadHeaders:{default:()=>({})}},{modelValue:{default:""},modelModifiers:{}}),emits:O(["mounted"],["update:modelValue"]),setup(e,{emit:n}){const t=e,l=n,a=new URL("/assets/tinymce.min-BBh9ssQk.js",import.meta.url).href,s=G(e,"modelValue"),m=Te(null),f=V(()=>t.isDark?"oxide-dark":"oxide"),r=V(()=>t.isDark?"dark":"default"),E=V(()=>t.locale.replace("-","_").includes("en_US")?"en":"zh_CN"),C=H(!0);M(()=>[t.isDark,t.locale],async()=>{m.value&&(m.value.destroy(),C.value=!1,await W(),C.value=!0)});const A=new AbortController;ae(()=>{A.abort()});const T=H(!0),N=V(()=>{const{height:g,options:h,plugins:c,toolbar:p}=t;return{auto_focus:!0,branding:!1,content_css:r.value,content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }",contextmenu:"link image table",default_link_target:"_blank",height:g,image_advtab:!0,image_caption:!0,importcss_append:!0,language:E.value,link_title:!1,menubar:"file edit view insert format tools table help",noneditable_class:"mceNonEditable",paste_data_images:!0,images_file_types:"jpeg,jpg,png,gif,bmp,webp",plugins:c,quickbars_selection_toolbar:"bold italic | quicklink h2 h3 blockquote quickimage quicktable",skin:f.value,toolbar:p,toolbar_mode:"sliding",...h,images_upload_handler:(k,B)=>new Promise((b,u)=>{const _=k.blob(),x=new FormData;x.append("file",_);const y=new XMLHttpRequest;y.upload.addEventListener("progress",S=>{if(S.lengthComputable){const w=S.loaded/S.total*100;B(w)}}),y.addEventListener("load",()=>{var S;if(y.status>=200&&y.status<300)try{const w=JSON.parse(y.responseText);b((S=w==null?void 0:w.data)==null?void 0:S.url)}catch{u({message:`上传失败: ${y.responseText}`,remove:!0})}else u({message:`上传失败: ${y.statusText}`,remove:!0})}),y.addEventListener("error",S=>{u(S)}),y.addEventListener("abort",()=>{u({message:"上传已取消",remove:!0})}),y.open("POST",t.uploadUrl,!0);for(const[S,w]of Object.entries(t.uploadHeaders))y.setRequestHeader(S,w);y.send(x)}),setup:k=>{m.value=k,k.on("init",()=>{l("mounted"),T.value=!1})}}}),D=De(),v=V(()=>{const g={};for(const h in D)if(h.startsWith("on")){const c=Qe(h.split("on")[1]);g[c]=D[h]}return g});return(g,h)=>(L(),ie("div",ht,[o(i(Ne),{show:T.value,class:"min-h-400px w-full"},{default:d(()=>[C.value?(L(),J(i(vt),Ee({key:0,modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=c=>s.value=c),class:"h-full w-full",init:N.value,"tinymce-script-src":i(a),disabled:g.disabled,"license-key":"gpl"},Be(v.value)),null,16,["modelValue","init","tinymce-script-src","disabled"])):xe("",!0)]),_:1},8,["show"])]))}}),wt={DEV:!1,VITE_APP_BASE_API:"/prod-api",VITE_APP_WEBSOCKET:"N",VITE_HTTP_PROXY:"Y"},Ct=$({name:"NoticeOperateDrawer",__name:"notice-operate-drawer",props:O({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:O(["submitted"],["update:visible"]),setup(e,{emit:n}){const t=e,l=n,a=G(e,"visible"),s=re(),m=Ae(),f=!1,{baseURL:r}=Ie(wt,f),E={Authorization:`Bearer ${Pe()}`,clientid:"e5cd7e4891bf95d1d19206ce24a7b32e"},{formRef:C,validate:A,restoreValidation:T}=ce(),{createRequiredRule:N}=He(),D=V(()=>({add:"新增通知公告",edit:"编辑通知公告"})[t.operateType]),v=Re(g());function g(){return{noticeTitle:"",noticeType:"1",noticeContent:"",status:"0"}}const h={noticeId:N("公告ID不能为空"),noticeTitle:N("公告标题不能为空"),noticeType:N("公告类型不能为空"),noticeContent:N("公告内容不能为空"),status:N("公告状态不能为空")};function c(){if(t.operateType==="add"){Object.assign(v,g());return}t.operateType==="edit"&&t.rowData&&Object.assign(v,t.rowData)}function p(){a.value=!1}async function k(){var B;if(await A(),t.operateType==="add"){const{noticeTitle:b,noticeType:u,noticeContent:_,status:x}=v,{error:y}=await et({noticeTitle:b,noticeType:u,noticeContent:_,status:x});if(y)return}if(t.operateType==="edit"){const{noticeId:b,noticeTitle:u,noticeType:_,noticeContent:x,status:y}=v,{error:S}=await tt({noticeId:b,noticeTitle:u,noticeType:_,noticeContent:x,status:y});if(S)return}(B=window.$message)==null||B.success(P("common.updateSuccess")),p(),l("submitted")}return M(a,()=>{a.value&&(c(),T())}),(B,b)=>{const u=le,_=We,x=qe,y=de,S=se,w=me,fe=Ue,_e=Ve;return L(),J(_e,{show:a.value,"onUpdate:show":b[4]||(b[4]=R=>a.value=R),"trap-focus":!1,title:D.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:d(()=>[o(fe,{title:D.value,"native-scrollbar":!1,closable:""},{footer:d(()=>[o(w,{size:16},{default:d(()=>[o(S,{onClick:p},{default:d(()=>[j(F(i(P)("common.cancel")),1)]),_:1}),o(S,{type:"primary",onClick:k},{default:d(()=>[j(F(i(P)("common.confirm")),1)]),_:1})]),_:1})]),default:d(()=>[o(y,{ref_key:"formRef",ref:C,model:v,rules:h},{default:d(()=>[o(_,{label:"公告标题",path:"noticeTitle"},{default:d(()=>[o(u,{value:v.noticeTitle,"onUpdate:value":b[0]||(b[0]=R=>v.noticeTitle=R),placeholder:"请输入公告标题"},null,8,["value"])]),_:1}),o(_,{label:"公告类型",path:"noticeType"},{default:d(()=>[o(x,{value:v.noticeType,"onUpdate:value":b[1]||(b[1]=R=>v.noticeType=R),"dict-code":"sys_notice_type"},null,8,["value"])]),_:1}),o(_,{label:"公告内容",path:"noticeContent"},{default:d(()=>[o(i(bt),{modelValue:v.noticeContent,"onUpdate:modelValue":b[2]||(b[2]=R=>v.noticeContent=R),lang:i(s).locale,"is-dark":i(m).darkMode,"upload-url":`${i(r)}/resource/oss/upload`,"upload-headers":E},null,8,["modelValue","lang","is-dark","upload-url"])]),_:1}),o(_,{label:"公告状态",path:"status"},{default:d(()=>[o(x,{value:v.status,"onUpdate:value":b[3]||(b[3]=R=>v.status=R),"dict-code":"sys_normal_disable"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),kt=$({name:"NoticeSearch",__name:"notice-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(e,{emit:n}){const t=n,{formRef:l,validate:a,restoreValidation:s}=ce(),m=G(e,"model");async function f(){await s(),t("reset")}async function r(){await a(),t("search")}return(E,C)=>{const A=le,T=$e,N=Ge,D=ve,v=se,g=ye,h=me,c=Je,p=de,k=Le,B=Oe,b=ue;return L(),J(b,{bordered:!1,size:"small",class:"card-wrapper"},{default:d(()=>[o(B,null,{default:d(()=>[o(k,{title:i(P)("common.search"),name:"user-search"},{default:d(()=>[o(p,{ref_key:"formRef",ref:l,model:m.value,"label-placement":"left","label-width":80},{default:d(()=>[o(c,{responsive:"screen","item-responsive":""},{default:d(()=>[o(T,{span:"8",label:"公告标题",path:"noticeTitle",class:"pr-24px"},{default:d(()=>[o(A,{value:m.value.noticeTitle,"onUpdate:value":C[0]||(C[0]=u=>m.value.noticeTitle=u),placeholder:"请输入公告标题"},null,8,["value"])]),_:1}),o(T,{span:"8",label:"公告类型",path:"noticeType",class:"pr-24px"},{default:d(()=>[o(N,{value:m.value.noticeType,"onUpdate:value":C[1]||(C[1]=u=>m.value.noticeType=u),"dict-code":"sys_notice_type",placeholder:"请选择公告类型"},null,8,["value"])]),_:1}),o(T,{span:"8",class:"pr-24px"},{default:d(()=>[o(h,{class:"w-full",justify:"end"},{default:d(()=>[o(v,{onClick:f},{icon:d(()=>[o(D,{class:"text-icon"})]),default:d(()=>[j(" "+F(i(P)("common.reset")),1)]),_:1}),o(v,{type:"primary",ghost:"",onClick:r},{icon:d(()=>[o(g,{class:"text-icon"})]),default:d(()=>[j(" "+F(i(P)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),St={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},$t=$({name:"system_notice",__name:"index",setup(e){Q("sys_notice_type"),Q("sys_normal_disable");const n=re(),{hasAuth:t}=ze(),{columns:l,columnChecks:a,data:s,getData:m,getDataByPage:f,loading:r,mobilePagination:E,searchParams:C,resetSearchParams:A}=je({apiFn:Ze,apiParams:{pageNum:1,pageSize:10,noticeTitle:null,noticeType:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"noticeTitle",title:"公告标题",align:"center",width:300},{key:"noticeType",title:"公告类型",align:"center",minWidth:120,render(u){return o(Z,{size:"small",value:u.noticeType,dictCode:"sys_notice_type"},null)}},{key:"status",title:"公告状态",align:"center",minWidth:120,render(u){return o(Z,{size:"small",value:u.status,dictCode:"sys_normal_disable"},null)}},{key:"createByName",title:"创建者",align:"center",minWidth:120},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"operate",title:P("common.operate"),align:"center",width:130,render:u=>{const _=()=>!t("system:notice:edit")||!t("system:notice:remove")?null:o(Me,{vertical:!0},null),x=()=>t("system:notice:edit")?o(Y,{text:!0,type:"primary",icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:P("common.edit"),onClick:()=>b(u.noticeId)},null):null,y=()=>t("system:notice:remove")?o(Y,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:P("common.delete"),popconfirmContent:P("common.confirmDelete"),onPositiveClick:()=>B(u.noticeId)},null):null;return o("div",{class:"flex-center gap-8px"},[x(),_(),y()])}}]}),{drawerVisible:T,operateType:N,editingData:D,handleAdd:v,handleEdit:g,checkedRowKeys:h,onBatchDeleted:c,onDeleted:p}=Fe(s,m);async function k(){const{error:u}=await ee(h.value);u||c()}async function B(u){const{error:_}=await ee([u]);_||p()}async function b(u){g("noticeId",u)}return(u,_)=>{const x=ge,y=Xe,S=ue;return L(),ie("div",St,[o(kt,{model:i(C),"onUpdate:model":_[0]||(_[0]=w=>z(C)?C.value=w:null),onReset:i(A),onSearch:i(f)},null,8,["model","onReset","onSearch"]),o(S,{title:"通知公告列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":d(()=>[o(x,{columns:i(a),"onUpdate:columns":_[1]||(_[1]=w=>z(a)?a.value=w:null),"disabled-delete":i(h).length===0,loading:i(r),"show-add":i(t)("system:notice:add"),"show-delete":i(t)("system:notice:remove"),"show-export":!1,onAdd:i(v),onDelete:k,onRefresh:i(m)},null,8,["columns","disabled-delete","loading","show-add","show-delete","onAdd","onRefresh"])]),default:d(()=>[o(y,{"checked-row-keys":i(h),"onUpdate:checkedRowKeys":_[2]||(_[2]=w=>z(h)?h.value=w:null),columns:i(l),data:i(s),size:"small","flex-height":!i(n).isMobile,"scroll-x":962,loading:i(r),remote:"","row-key":w=>w.noticeId,pagination:i(E),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),o(Ct,{visible:i(T),"onUpdate:visible":_[3]||(_[3]=w=>z(T)?T.value=w:null),"operate-type":i(N),"row-data":i(D),onSubmitted:i(f)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{$t as default};
