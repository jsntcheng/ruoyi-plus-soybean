import{_ as te,a as ne,b as oe}from"./round-refresh-B0IUvXWI.js";import{_ as ae}from"./warning-outline-rounded-C1g9t3lm.js";import{aj as T,d as W,ak as G,r as le,al as H,c as M,o as B,w as t,f as e,h as a,$ as D,v as se,B as E,g,t as _,R as K,an as ie,e as j,_ as U,ap as re,I as ce,b as ue,af as $,s as me,A as F,aq as de,a3 as pe}from"./index-Z8DUt18u.js";import{_ as _e,a as fe,b as ge,u as ve}from"./auth-CEy-eMOu.js";import{u as we}from"./download-4Fcgw4rI.js";import{u as he,a as ye}from"./table-xLscuIQ4.js";import{u as A}from"./dict-D3hWHJVt.js";import{g as O,a as J}from"./icon-tag-format-DohP3qh_.js";import{_ as V}from"./dict-tag.vue_vue_type_script_setup_true_lang-C3NRfqiy.js";import{_ as be}from"./dict-select.vue_vue_type_script_setup_true_lang-B4-DraB3.js";import{u as xe,b as ke}from"./form-34oM_FHm.js";import{_ as Ne}from"./DatePicker-CLebrfbL.js";import{_ as De}from"./Grid-tUpxGiRj.js";import{_ as Q}from"./Space-CCrTpFrl.js";import{_ as Ie,a as Ce}from"./DescriptionsItem-Hm123lMn.js";import{_ as $e}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";import"./index-DbR6TmJ_.js";function Be(d){return T({url:"/monitor/logininfor/list",method:"get",params:d})}function Te(d){return T({url:`/monitor/logininfor/${d.join(",")}`,method:"delete"})}function Le(d){return T({url:`/monitor/logininfor/unlock/${d}`,method:"get"})}function Se(){return T({url:"/monitor/logininfor/clean",method:"delete"})}const ze=W({name:"LoginInforSearch",__name:"login-infor-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(d,{emit:r}){const w=r,{formRef:y,validate:I,restoreValidation:h}=xe(),i=le(null),c=H(d,"model");async function b(){i.value=null,await h(),w("reset")}async function k(){var x;await I(),(x=i.value)!=null&&x.length&&(c.value.params.beginTime=i.value[0],c.value.params.endTime=i.value[1]),w("search")}return(x,u)=>{const N=se,p=ge,n=be,m=Ne,f=te,C=E,L=ne,S=Q,z=De,P=ke,R=fe,o=_e,l=K;return B(),M(l,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(o,null,{default:t(()=>[e(R,{title:a(D)("common.search"),name:"user-search"},{default:t(()=>[e(P,{ref_key:"formRef",ref:y,model:c.value,"label-placement":"left","label-width":80},{default:t(()=>[e(z,{responsive:"screen","item-responsive":""},{default:t(()=>[e(p,{span:"24 s:12 m:6",label:"IP地址",path:"ipaddr",class:"pr-24px"},{default:t(()=>[e(N,{value:c.value.ipaddr,"onUpdate:value":u[0]||(u[0]=s=>c.value.ipaddr=s),placeholder:"请输入登录IP地址"},null,8,["value"])]),_:1}),e(p,{span:"24 s:12 m:6",label:"用户账号",path:"userName",class:"pr-24px"},{default:t(()=>[e(N,{value:c.value.userName,"onUpdate:value":u[1]||(u[1]=s=>c.value.userName=s),placeholder:"请输入用户账号"},null,8,["value"])]),_:1}),e(p,{span:"24 s:12 m:6",label:"登录状态",path:"status",class:"pr-24px"},{default:t(()=>[e(n,{value:c.value.status,"onUpdate:value":u[2]||(u[2]=s=>c.value.status=s),placeholder:"请选择登录状态","dict-code":"sys_common_status",clearable:""},null,8,["value"])]),_:1}),e(p,{span:"24 s:12 m:6",label:"登录时间",path:"loginTime",class:"pr-24px"},{default:t(()=>[e(m,{"formatted-value":i.value,"onUpdate:formattedValue":u[3]||(u[3]=s=>i.value=s),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",clearable:""},null,8,["formatted-value"])]),_:1}),e(p,{span:"24",class:"pr-24px"},{default:t(()=>[e(S,{class:"w-full",justify:"end"},{default:t(()=>[e(C,{onClick:b},{icon:t(()=>[e(f,{class:"text-icon"})]),default:t(()=>[g(" "+_(a(D)("common.reset")),1)]),_:1}),e(C,{type:"primary",ghost:"",onClick:k},{icon:t(()=>[e(L,{class:"text-icon"})]),default:t(()=>[g(" "+_(a(D)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Pe={class:"flex items-center gap-2"},Re={class:"flex items-center gap-2"},q="登录信息详情",Ue=W({name:"LoginInforViewDrawer",__name:"login-infor-view-drawer",props:G({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const r=d,w=H(d,"visible");function y(){w.value=!1}return(I,h)=>{const i=Ce,c=V,b=U,k=Ie,x=E,u=Q,N=ie,p=re;return B(),M(p,{show:w.value,"onUpdate:show":h[0]||(h[0]=n=>w.value=n),title:q,"display-directive":"show",width:800,class:"max-w-90%"},{default:t(()=>[e(N,{title:q,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(u,{size:16},{default:t(()=>[e(x,{onClick:y},{default:t(()=>[g(_(a(D)("common.close")),1)]),_:1})]),_:1})]),default:t(()=>[e(k,{"label-placement":"left",column:1,size:"small",bordered:""},{default:t(()=>[e(i,{label:"账号信息"},{default:t(()=>{var n,m,f;return[g(_((n=r.rowData)==null?void 0:n.userName)+" | "+_((m=r.rowData)==null?void 0:m.ipaddr)+" | "+_((f=r.rowData)==null?void 0:f.loginLocation),1)]}),_:1}),e(i,{label:"客户端"},{default:t(()=>{var n;return[g(_((n=r.rowData)==null?void 0:n.clientKey),1)]}),_:1}),e(i,{label:"设备类型"},{default:t(()=>{var n;return[e(c,{size:"small",value:(n=r.rowData)==null?void 0:n.deviceType,"dict-code":"sys_device_type"},null,8,["value"])]}),_:1}),e(i,{label:"浏览器类型"},{default:t(()=>{var n,m;return[j("div",Pe,[e(b,{icon:a(O)(((n=r.rowData)==null?void 0:n.browser)??"")},null,8,["icon"]),g(" "+_((m=r.rowData)==null?void 0:m.browser),1)])]}),_:1}),e(i,{label:"操作系统"},{default:t(()=>{var n,m;return[j("div",Re,[e(b,{icon:a(J)(((n=r.rowData)==null?void 0:n.os)??"")},null,8,["icon"]),g(" "+_((m=r.rowData)==null?void 0:m.os),1)])]}),_:1}),e(i,{label:"登录状态"},{default:t(()=>{var n;return[e(c,{size:"small",value:(n=r.rowData)==null?void 0:n.status,"dict-code":"sys_common_status"},null,8,["value"])]}),_:1}),e(i,{label:"提示消息"},{default:t(()=>{var n;return[g(_((n=r.rowData)==null?void 0:n.msg),1)]}),_:1}),e(i,{label:"访问时间"},{default:t(()=>{var n;return[g(_((n=r.rowData)==null?void 0:n.loginTime),1)]}),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ot=W({name:"monitor_logininfor",__name:"index",setup(d){const r=ce(),{download:w}=we(),{hasAuth:y}=ve();A("sys_common_status"),A("sys_device_type");const{columns:I,columnChecks:h,data:i,getData:c,getDataByPage:b,loading:k,mobilePagination:x,searchParams:u,resetSearchParams:N}=he({apiFn:Be,apiParams:{pageNum:1,pageSize:10,userName:null,ipaddr:null,status:null,params:{}},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:D("common.index"),align:"center",width:64},{key:"userName",title:"用户账号",align:"center",minWidth:120},{key:"deviceType",title:"设备类型",align:"center",minWidth:120,render:o=>e(V,{size:"small",value:o.deviceType,"dict-code":"sys_device_type"},null)},{key:"ipaddr",title:"登录IP地址",align:"center",minWidth:120},{key:"loginLocation",title:"登录地点",align:"center",minWidth:120},{key:"browser",title:"浏览器类型",align:"center",minWidth:120,render:o=>e("div",{class:"flex items-center justify-center gap-2"},[e(U,{icon:O(o.browser)},null),o.browser])},{key:"os",title:"操作系统",align:"center",ellipsis:{tooltip:!0},minWidth:120,render:o=>{var s;const l=((s=o.os)==null?void 0:s.split(" or ")[0])??"";return e("div",{class:"flex items-center justify-center gap-2"},[e(U,{icon:J(l)},null),l])}},{key:"status",title:"登录状态",align:"center",minWidth:120,render:o=>e(V,{size:"small",value:o.status,"dict-code":"sys_common_status"},null)},{key:"loginTime",title:"访问时间",align:"center",ellipsis:{tooltip:!0},minWidth:120},{key:"operate",title:D("common.operate"),align:"center",width:130,render:o=>{const l=()=>e(F,{type:"primary",text:!0,icon:"material-symbols:visibility-outline",tooltipContent:"详情",onClick:()=>S(o.infoId)},null),s=()=>e(pe,null,[e(de,{vertical:!0},null),e(F,{type:"primary",text:!0,icon:"material-symbols:lock-open-outline",tooltipContent:"解锁",popconfirmContent:`确认解锁用户 ${o.userName} 吗？`,onPositiveClick:()=>R(o.userName)},null)]);return e("div",{class:"flex-center gap-8px"},[l(),s()])}}]}),{drawerVisible:p,editingData:n,handleEdit:m,checkedRowKeys:f,onBatchDeleted:C}=ye(i,c);async function L(){const{error:o}=await Te(f.value);o||C()}async function S(o){m("infoId",o)}async function z(){w("/monitor/logininfor/export",u,`登录日志记录_${new Date().getTime()}.xlsx`)}async function P(){var o;(o=window.$dialog)==null||o.error({title:"提示",content:"是否确认清空所有登录日志数据项?",positiveText:"确认清空",negativeText:"取消",onPositiveClick:async()=>{var s;const{error:l}=await Se();l||((s=window.$message)==null||s.success("清空成功"),await c())}})}async function R(o){var s;const{error:l}=await Le(o);l||((s=window.$message)==null||s.success("解锁成功"),await b())}return(o,l)=>{const s=ae,X=E,Y=oe,Z=$e,ee=K;return B(),ue("div",Ve,[e(ze,{model:a(u),"onUpdate:model":l[0]||(l[0]=v=>$(u)?u.value=v:null),onReset:a(N),onSearch:a(b)},null,8,["model","onReset","onSearch"]),e(ee,{title:"登录日志列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(Y,{columns:a(h),"onUpdate:columns":l[1]||(l[1]=v=>$(h)?h.value=v:null),"disabled-delete":a(f).length===0,loading:a(k),"show-add":!1,"show-delete":a(y)("monitor:logininfor:remove"),"show-export":a(y)("monitor:logininfor:export"),onDelete:L,onExport:z,onRefresh:a(c)},{prefix:t(()=>[a(y)("monitor:logininfor:remove")?(B(),M(X,{key:0,type:"error",ghost:"",size:"small",onClick:P},{icon:t(()=>[e(s)]),default:t(()=>[l[4]||(l[4]=g(" 清空 "))]),_:1})):me("",!0)]),_:1},8,["columns","disabled-delete","loading","show-delete","show-export","onRefresh"])]),default:t(()=>[e(Z,{"checked-row-keys":a(f),"onUpdate:checkedRowKeys":l[2]||(l[2]=v=>$(f)?f.value=v:null),columns:a(I),data:a(i),size:"small","flex-height":!a(r).isMobile,"scroll-x":962,loading:a(k),remote:"","row-key":v=>v.infoId,pagination:a(x),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ue,{visible:a(p),"onUpdate:visible":l[3]||(l[3]=v=>$(p)?p.value=v:null),"row-data":a(n)},null,8,["visible","row-data"])]),_:1})])}}});export{ot as default};
