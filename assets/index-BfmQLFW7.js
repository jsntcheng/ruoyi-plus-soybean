import{_ as P,a as W,b as D}from"./round-refresh-B0IUvXWI.js";import{d as I,ak as E,al as M,c as U,o as C,w as n,f as e,h as s,$ as d,v as j,B as z,g as N,t as w,R as $,I as Y,b as G,af as b,_ as B,aX as H,A as O}from"./index-Z8DUt18u.js";import{b as V,a as q}from"./online-CTDiVd2S.js";import{_ as X,a as J,b as K,u as Q}from"./auth-CEy-eMOu.js";import{u as Z}from"./table-xLscuIQ4.js";import{u as F}from"./dict-D3hWHJVt.js";import{g as ee,a as oe}from"./icon-tag-format-DohP3qh_.js";import{_ as ne}from"./dict-tag.vue_vue_type_script_setup_true_lang-C3NRfqiy.js";import{u as te,b as se}from"./form-34oM_FHm.js";import{_ as ae}from"./Grid-tUpxGiRj.js";import{_ as le}from"./Space-CCrTpFrl.js";import{_ as re}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";const ie=I({name:"LoginInforSearch",__name:"online-search",props:{model:{required:!0},modelModifiers:{}},emits:E(["reset","search"],["update:model"]),setup(x,{emit:f}){const u=f,{formRef:h,validate:c,restoreValidation:g}=te(),a=M(x,"model");async function p(){await g(),u("reset")}async function m(){await c(),u("search")}return(k,r)=>{const o=j,t=K,i=P,_=z,v=W,l=le,L=ae,R=se,S=J,T=X,A=$;return C(),U(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(T,null,{default:n(()=>[e(S,{title:s(d)("common.search"),name:"user-search"},{default:n(()=>[e(R,{ref_key:"formRef",ref:h,model:a.value,"label-placement":"left","label-width":80},{default:n(()=>[e(L,{responsive:"screen","item-responsive":""},{default:n(()=>[e(t,{span:"24 s:12 m:6",label:"IP地址",path:"ipaddr",class:"pr-24px"},{default:n(()=>[e(o,{value:a.value.ipaddr,"onUpdate:value":r[0]||(r[0]=y=>a.value.ipaddr=y),placeholder:"请输入IP地址"},null,8,["value"])]),_:1}),e(t,{span:"24 s:12 m:6",label:"用户账号",path:"userName",class:"pr-24px"},{default:n(()=>[e(o,{value:a.value.userName,"onUpdate:value":r[1]||(r[1]=y=>a.value.userName=y),placeholder:"请输入用户账号"},null,8,["value"])]),_:1}),e(t,{span:"24",class:"pr-24px"},{default:n(()=>[e(l,{class:"w-full",justify:"end"},{default:n(()=>[e(_,{onClick:p},{icon:n(()=>[e(i,{class:"text-icon"})]),default:n(()=>[N(" "+w(s(d)("common.reset")),1)]),_:1}),e(_,{type:"primary",ghost:"",onClick:m},{icon:n(()=>[e(v,{class:"text-icon"})]),default:n(()=>[N(" "+w(s(d)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},be=I({name:"monitor_online",__name:"index",setup(x){const f=Y(),{hasAuth:u}=Q();F("sys_common_status"),F("sys_device_type");const{columns:h,columnChecks:c,data:g,getData:a,loading:p,searchParams:m,resetSearchParams:k}=Z({apiFn:V,apiParams:{userName:null,ipaddr:null},columns:()=>[{key:"userName",title:"用户账号",align:"center",minWidth:120},{key:"deviceType",title:"设备类型",align:"center",minWidth:120,render:o=>e(ne,{size:"small",value:o.deviceType,"dict-code":"sys_device_type"},null)},{key:"ipaddr",title:"登录IP地址",align:"center",minWidth:120},{key:"loginLocation",title:"登录地点",align:"center",minWidth:120},{key:"browser",title:"浏览器类型",align:"center",minWidth:120,render:o=>e("div",{class:"flex items-center justify-center gap-2"},[e(B,{icon:ee(o.browser)},null),o.browser])},{key:"os",title:"操作系统",align:"center",ellipsis:{tooltip:!0},minWidth:120,render:o=>{var i;const t=((i=o.os)==null?void 0:i.split(" or ")[0])??"";return e("div",{class:"flex items-center justify-center gap-2"},[e(B,{icon:oe(t)},null),t])}},{key:"loginTime",title:"登录时间",align:"center",ellipsis:{tooltip:!0},minWidth:120,render:o=>H(o.loginTime).format("YYYY-MM-DD HH:mm:ss")},{key:"operate",title:d("common.operate"),align:"center",width:130,render:o=>e("div",null,[u("monitor:online:forceLogout")?e(O,{text:!0,type:"error",icon:"material-symbols:delete-outline",class:"text-20px",tooltipContent:"强制下线",popconfirmContent:"确认强制下线吗？",onPositiveClick:()=>r(o.tokenId)},null):null])}]});async function r(o){const{error:t}=await q(o);t||a()}return(o,t)=>{const i=D,_=re,v=$;return C(),G("div",ce,[e(ie,{model:s(m),"onUpdate:model":t[0]||(t[0]=l=>b(m)?m.value=l:null),onReset:s(k),onSearch:s(a)},null,8,["model","onReset","onSearch"]),e(v,{title:"在线用户列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(i,{columns:s(c),"onUpdate:columns":t[1]||(t[1]=l=>b(c)?c.value=l:null),loading:s(p),"show-add":!1,"show-delete":!1,"show-export":!1,onRefresh:s(a)},null,8,["columns","loading","onRefresh"])]),default:n(()=>[e(_,{columns:s(h),data:s(g),size:"small","flex-height":!s(f).isMobile,"scroll-x":962,loading:s(p),remote:"","row-key":l=>l.tokenId,class:"sm:h-full"},null,8,["columns","data","flex-height","loading","row-key"])]),_:1})])}}});export{be as default};
