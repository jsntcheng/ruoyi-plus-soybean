import{f as Y,a as Z,b as z,c as ee,d as ae}from"./tenant-package-DVl4jZkt.js";import{d as V,ak as L,al as G,c as O,o as q,w as o,f as a,h as e,$ as t,v as K,N as te,B as W,g as A,t as F,R as H,r as E,p as ne,a as oe,q as se,am as le,an as re,s as ce,af as $,ap as ie,I as me,b as pe,aq as ue,A as j}from"./index-Z8DUt18u.js";import{_ as de,a as ge,b as _e,u as fe}from"./auth-CEy-eMOu.js";import{u as ke}from"./download-4Fcgw4rI.js";import{u as ye,a as he}from"./table-xLscuIQ4.js";import{_ as ve,a as we,b as be}from"./round-refresh-B0IUvXWI.js";import{_ as Ne}from"./status-switch.vue_vue_type_script_setup_true_lang-SMgoHDPQ.js";import{u as Pe}from"./dict-D3hWHJVt.js";import{u as J,b as Q,a as xe,_ as Te}from"./form-34oM_FHm.js";import{_ as Ce}from"./Grid-tUpxGiRj.js";import{_ as X}from"./Space-CCrTpFrl.js";import{g as Ie}from"./menu-Xcd0YzZ-.js";import{M as De}from"./menu-tree-CifRtWYH.js";import{_ as Se}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./business-CduYu0Mf.js";import"./dict-CTAJ1fRb.js";import"./Tree-C1TOTihx.js";const Re=V({name:"TenantPackageSearch",__name:"tenant-package-search",props:{model:{required:!0},modelModifiers:{}},emits:L(["reset","search"],["update:model"]),setup(D,{emit:S}){const p=S,{formRef:d,validate:b,restoreValidation:y}=J(),i=G(D,"model"),{options:N}=Pe("sys_normal_disable");async function x(){Object.assign(i.value.params,{}),await y(),p("reset")}async function g(){await b(),p("search")}return(M,_)=>{const R=K,h=_e,T=te,c=ve,P=W,U=we,v=X,C=Ce,B=Q,f=ge,s=de,k=H;return q(),O(k,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(s,null,{default:o(()=>[a(f,{title:e(t)("common.search"),name:"user-search"},{default:o(()=>[a(B,{ref_key:"formRef",ref:d,model:i.value,"label-placement":"left","label-width":80},{default:o(()=>[a(C,{responsive:"screen","item-responsive":""},{default:o(()=>[a(h,{span:"8",label:e(t)("page.system.tenantPackage.packageName"),path:"packageName",class:"pr-24px"},{default:o(()=>[a(R,{value:i.value.packageName,"onUpdate:value":_[0]||(_[0]=u=>i.value.packageName=u),placeholder:e(t)("page.system.tenantPackage.form.packageName.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(h,{span:"8",label:e(t)("page.system.tenantPackage.status"),path:"status",class:"pr-24px"},{default:o(()=>[a(T,{value:i.value.status,"onUpdate:value":_[1]||(_[1]=u=>i.value.status=u),placeholder:e(t)("page.system.tenantPackage.form.status.required"),options:e(N),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(h,{span:"8",class:"pr-24px"},{default:o(()=>[a(v,{class:"w-full",justify:"end"},{default:o(()=>[a(P,{onClick:x},{icon:o(()=>[a(c,{class:"text-icon"})]),default:o(()=>[A(" "+F(e(t)("common.reset")),1)]),_:1}),a(P,{type:"primary",ghost:"",onClick:g},{icon:o(()=>[a(U,{class:"text-icon"})]),default:o(()=>[A(" "+F(e(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ue=V({name:"TenantPackageOperateDrawer",__name:"tenant-package-operate-drawer",props:L({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:L(["submitted"],["update:visible"]),setup(D,{emit:S}){const p=D,d=S,b=E(null),y=E([]),{loading:i,startLoading:N,endLoading:x}=ne(),g=G(D,"visible"),{formRef:M,validate:_,restoreValidation:R}=J(),{createRequiredRule:h}=xe(),T=oe(()=>({add:t("page.system.tenantPackage.addTenantPackage"),edit:t("page.system.tenantPackage.editTenantPackage")})[p.operateType]),c=se(P());function P(){return{packageName:"",menuIds:[],remark:"",menuCheckStrictly:!0}}const U={packageId:h(t("page.system.tenantPackage.form.packageName.invalid")),packageName:h(t("page.system.tenantPackage.form.packageName.required"))};async function v(){var f;if(y.value=[],c.menuIds=[],p.operateType==="add"){(f=b.value)==null||f.refresh(),Object.assign(c,P());return}if(p.operateType==="edit"&&p.rowData){N(),Object.assign(c,{...p.rowData,menuIds:[]});const{data:s,error:k}=await Ie(c.packageId);if(k)return;c.menuIds=s.checkedKeys,y.value=s.menus,x()}}function C(){g.value=!1}async function B(){var r,l;await _();const{packageId:f,packageName:s,remark:k,menuCheckStrictly:u}=c,I=(r=b.value)==null?void 0:r.getCheckedMenuIds();if(p.operateType==="add"){const{error:m}=await Y({packageName:s,menuIds:I,remark:k,menuCheckStrictly:u});if(m)return}if(p.operateType==="edit"){const{error:m}=await Z({packageId:f,packageName:s,menuIds:I,remark:k,menuCheckStrictly:u});if(m)return}(l=window.$message)==null||l.success(t("common.saveSuccess")),C(),d("submitted")}return le(g,()=>{g.value&&(v(),R())}),(f,s)=>{const k=K,u=Te,I=Q,r=W,l=X,m=re,w=ie;return q(),O(w,{show:g.value,"onUpdate:show":s[6]||(s[6]=n=>g.value=n),title:T.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:o(()=>[a(m,{title:T.value,"native-scrollbar":!1,closable:""},{footer:o(()=>[a(l,{size:16},{default:o(()=>[a(r,{onClick:C},{default:o(()=>[A(F(e(t)("common.cancel")),1)]),_:1}),a(r,{type:"primary",onClick:B},{default:o(()=>[A(F(e(t)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[a(I,{ref_key:"formRef",ref:M,model:c,rules:U},{default:o(()=>[a(u,{label:e(t)("page.system.tenantPackage.packageName"),path:"packageName"},{default:o(()=>[a(k,{value:c.packageName,"onUpdate:value":s[0]||(s[0]=n=>c.packageName=n),placeholder:e(t)("page.system.tenantPackage.form.packageName.required")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(u,{label:e(t)("page.system.tenantPackage.menuIds"),path:"menuIds"},{default:o(()=>[g.value?(q(),O(De,{key:0,ref_key:"menuTreeRef",ref:b,"checked-keys":c.menuIds,"onUpdate:checkedKeys":s[1]||(s[1]=n=>c.menuIds=n),options:y.value,"onUpdate:options":s[2]||(s[2]=n=>y.value=n),cascade:c.menuCheckStrictly,"onUpdate:cascade":s[3]||(s[3]=n=>c.menuCheckStrictly=n),loading:e(i),"onUpdate:loading":s[4]||(s[4]=n=>$(i)?i.value=n:null),immediate:f.operateType==="add"},null,8,["checked-keys","options","cascade","loading","immediate"])):ce("",!0)]),_:1},8,["label"]),a(u,{label:e(t)("page.system.tenantPackage.remark"),path:"remark"},{default:o(()=>[a(k,{value:c.remark,"onUpdate:value":s[5]||(s[5]=n=>c.remark=n),placeholder:e(t)("page.system.tenantPackage.form.remark.required"),type:"textarea"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Ye=V({name:"system_tenant-package",__name:"index",setup(D){const S=me(),{download:p}=ke(),{hasAuth:d}=fe(),{columns:b,columnChecks:y,data:i,getData:N,getDataByPage:x,loading:g,mobilePagination:M,searchParams:_,resetSearchParams:R}=ye({apiFn:ee,apiParams:{pageNum:1,pageSize:10,packageName:null,status:null,params:{}},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:t("common.index"),align:"center",width:64},{key:"packageName",title:t("page.system.tenantPackage.packageName"),align:"center",minWidth:120},{key:"status",title:t("page.system.tenantPackage.status"),align:"center",minWidth:120,render:r=>a(Ne,{value:r.status,"onUpdate:value":l=>r.status=l,info:r.packageName,onSubmitted:(l,m)=>I(r,l,m)},null)},{key:"remark",title:t("page.system.tenantPackage.remark"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:r=>{const l=()=>!d("system:tenantPackage:edit")||!d("system:tenantPackage:remove")?null:a(ue,{vertical:!0},null),m=()=>d("system:tenantPackage:edit")?a(j,{text:!0,type:"primary",icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:t("common.edit"),onClick:()=>k(r.packageId)},null):null,w=()=>d("system:tenantPackage:remove")?a(j,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:t("common.delete"),popconfirmContent:t("common.confirmDelete"),onPositiveClick:()=>s(r.packageId)},null):null;return a("div",{class:"flex-center gap-8px"},[m(),l(),w()])}}]}),{drawerVisible:h,operateType:T,editingData:c,handleAdd:P,handleEdit:U,checkedRowKeys:v,onBatchDeleted:C,onDeleted:B}=he(i,N);async function f(){const{error:r}=await z(v.value);r||C()}async function s(r){const{error:l}=await z([r]);l||B()}function k(r){U("packageId",r)}function u(){p("/system/tenant/package/export",_,`${t("page.system.tenantPackage.title")}_${new Date().getTime()}.xlsx`)}async function I(r,l,m){var n;const{error:w}=await ae({packageId:r.packageId,status:l});m(!w),w||((n=window.$message)==null||n.success(t("page.system.tenantPackage.statusChangeSuccess")),N())}return(r,l)=>{const m=Se,w=H;return q(),pe("div",Be,[a(Re,{model:e(_),"onUpdate:model":l[0]||(l[0]=n=>$(_)?_.value=n:null),onReset:e(R),onSearch:e(x)},null,8,["model","onReset","onSearch"]),a(w,{title:e(t)("page.system.tenantPackage.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[a(be,{columns:e(y),"onUpdate:columns":l[1]||(l[1]=n=>$(y)?y.value=n:null),"disabled-delete":e(v).length===0,loading:e(g),"show-add":e(d)("system:tenantPackage:add"),"show-delete":e(d)("system:tenantPackage:remove"),"show-export":e(d)("system:tenantPackage:export"),onAdd:e(P),onDelete:f,onExport:u,onRefresh:e(N)},null,8,["columns","disabled-delete","loading","show-add","show-delete","show-export","onAdd","onRefresh"])]),default:o(()=>[a(m,{"checked-row-keys":e(v),"onUpdate:checkedRowKeys":l[2]||(l[2]=n=>$(v)?v.value=n:null),columns:e(b),data:e(i),size:"small","flex-height":!e(S).isMobile,"scroll-x":962,loading:e(g),remote:"","row-key":n=>n.packageId,pagination:e(M),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ue,{visible:e(h),"onUpdate:visible":l[3]||(l[3]=n=>$(h)?h.value=n:null),"operate-type":e(T),"row-data":e(c),onSubmitted:e(x)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Ye as default};
