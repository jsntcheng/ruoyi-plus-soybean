import{_ as se,a as le,b as ie}from"./round-refresh-B0IUvXWI.js";import{aj as A,d as j,ak as H,al as E,a as re,q as ue,am as ce,c as M,o as T,w as n,f as e,an as pe,aq as V,g as w,v as L,bk as de,N as J,h as l,b as Q,a3 as me,a4 as fe,B as X,t as W,$ as h,ap as _e,r as ge,R as Y,I as ye,af as F,ag as G,A as q}from"./index-Z8DUt18u.js";import{_ as ve,a as be,b as he,u as ke}from"./auth-CEy-eMOu.js";import{u as we,a as Ne}from"./table-xLscuIQ4.js";import{u as Ce}from"./dict-D3hWHJVt.js";import{_ as xe}from"./status-switch.vue_vue_type_script_setup_true_lang-SMgoHDPQ.js";import{o as Ke,e as Se}from"./business-CduYu0Mf.js";import{u as Z,a as De,b as ee,_ as Ue}from"./form-34oM_FHm.js";import{_ as te,a as Ie}from"./Grid-tUpxGiRj.js";import{a as Oe,b as Pe,_ as Re}from"./DataTable-s6EYq0ve.js";import{_ as ne}from"./Space-CCrTpFrl.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";function $e(p){return A({url:"/resource/oss/config/list",method:"get",params:p})}function Be(p){return A({url:"/resource/oss/config",method:"post",data:p})}function Te(p){return A({url:"/resource/oss/config",method:"put",data:p})}function z(p){return A({url:`/resource/oss/config/${p.join(",")}`,method:"delete"})}function Ae(p){return A({url:"/resource/oss/config/changeStatus",method:"put",data:p})}const Fe=j({name:"OssConfigOperateDrawer",__name:"oss-config-operate-drawer",props:H({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:H(["submitted"],["update:visible"]),setup(p,{emit:R}){const u=p,$=R,v=E(p,"visible"),{formRef:U,validate:d,restoreValidation:I}=Z(),{createRequiredRule:g}=De(),O=re(()=>({add:"新增OSS配置",edit:"编辑OSS配置"})[u.operateType]),a=ue(f());function f(){return{configKey:"",accessKey:"",secretKey:"",bucketName:"",prefix:"",endpoint:"",domain:"",isHttps:"N",region:"",accessPolicy:"1",remark:""}}const N={ossConfigId:g("主键不能为空"),configKey:g("配置名称不能为空"),accessKey:g("accessKey不能为空"),secretKey:g("secretKey不能为空"),bucketName:g("桶名称不能为空"),endpoint:g("访问站点不能为空"),accessPolicy:g("桶权限类型不能为空")};function C(){if(u.operateType==="add"){Object.assign(a,f());return}u.operateType==="edit"&&u.rowData&&Object.assign(a,u.rowData)}function P(){v.value=!1}async function B(){var x;if(await d(),u.operateType==="add"){const{configKey:t,accessKey:b,secretKey:c,bucketName:r,prefix:K,endpoint:S,domain:D,isHttps:o,region:i,accessPolicy:_,remark:y}=a,{error:k}=await Be({configKey:t,accessKey:b,secretKey:c,bucketName:r,prefix:K,endpoint:S,domain:D,isHttps:o,region:i,accessPolicy:_,remark:y});if(k)return}if(u.operateType==="edit"){const{ossConfigId:t,configKey:b,accessKey:c,secretKey:r,bucketName:K,prefix:S,endpoint:D,domain:o,isHttps:i,region:_,accessPolicy:y,remark:k}=a,{error:m}=await Te({ossConfigId:t,configKey:b,accessKey:c,secretKey:r,bucketName:K,prefix:S,endpoint:D,domain:o,isHttps:i,region:_,accessPolicy:y,remark:k});if(m)return}(x=window.$message)==null||x.success(h("common.updateSuccess")),P(),$("submitted")}return ce(v,()=>{v.value&&(C(),I())}),(x,t)=>{const b=V,c=L,r=Ue,K=J,S=de,D=Pe,o=ne,i=Oe,_=Ie,y=te,k=ee,m=X,oe=pe,ae=_e;return T(),M(ae,{show:v.value,"onUpdate:show":t[11]||(t[11]=s=>v.value=s),title:O.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:n(()=>[e(oe,{title:O.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[e(o,{size:16},{default:n(()=>[e(m,{onClick:P},{default:n(()=>[w(W(l(h)("common.cancel")),1)]),_:1}),e(m,{type:"primary",onClick:B},{default:n(()=>[w(W(l(h)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(k,{ref_key:"formRef",ref:U,model:a,rules:N},{default:n(()=>[e(b,null,{default:n(()=>t[12]||(t[12]=[w("基本信息")])),_:1}),e(r,{label:"配置名称",path:"configKey"},{default:n(()=>[e(c,{value:a.configKey,"onUpdate:value":t[0]||(t[0]=s=>a.configKey=s),placeholder:"请输入配置名称"},null,8,["value"])]),_:1}),e(r,{label:"访问站点",path:"endpoint"},{default:n(()=>[e(S,null,{default:n(()=>[e(K,{value:a.isHttps,"onUpdate:value":t[1]||(t[1]=s=>a.isHttps=s),class:"w-110px",options:l(Ke),placeholder:"请选择访问协议"},null,8,["value","options"]),e(c,{value:a.endpoint,"onUpdate:value":t[2]||(t[2]=s=>a.endpoint=s),placeholder:"请输入访问站点"},null,8,["value"])]),_:1})]),_:1}),e(r,{label:"自定义域名",path:"domain"},{default:n(()=>[e(c,{value:a.domain,"onUpdate:value":t[3]||(t[3]=s=>a.domain=s),placeholder:"请输入自定义域名"},null,8,["value"])]),_:1}),e(b,null,{default:n(()=>t[13]||(t[13]=[w("认证信息")])),_:1}),e(r,{label:"accessKey",path:"accessKey"},{default:n(()=>[e(c,{value:a.accessKey,"onUpdate:value":t[4]||(t[4]=s=>a.accessKey=s),placeholder:"请输入 AccessKey"},null,8,["value"])]),_:1}),e(r,{label:"secretKey",path:"secretKey"},{default:n(()=>[e(c,{value:a.secretKey,"onUpdate:value":t[5]||(t[5]=s=>a.secretKey=s),placeholder:"请输入秘钥 SecretKey"},null,8,["value"])]),_:1}),e(b,null,{default:n(()=>t[14]||(t[14]=[w("桶信息")])),_:1}),e(r,{label:"桶名称",path:"bucketName"},{default:n(()=>[e(c,{value:a.bucketName,"onUpdate:value":t[6]||(t[6]=s=>a.bucketName=s),placeholder:"请输入桶名称"},null,8,["value"])]),_:1}),e(r,{label:"前缀",path:"prefix"},{default:n(()=>[e(c,{value:a.prefix,"onUpdate:value":t[7]||(t[7]=s=>a.prefix=s),placeholder:"请输入前缀"},null,8,["value"])]),_:1}),e(y,{cols:2,"x-gap":24},{default:n(()=>[e(_,null,{default:n(()=>[e(r,{label:"桶权限类型",path:"accessPolicy"},{default:n(()=>[e(i,{value:a.accessPolicy,"onUpdate:value":t[8]||(t[8]=s=>a.accessPolicy=s)},{default:n(()=>[e(o,null,{default:n(()=>[(T(!0),Q(me,null,fe(l(Se),s=>(T(),M(D,{key:s.value,value:s.value,label:s.label},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(r,{label:"域",path:"region"},{default:n(()=>[e(c,{value:a.region,"onUpdate:value":t[9]||(t[9]=s=>a.region=s),placeholder:"请输入域"},null,8,["value"])]),_:1}),e(r,{label:"备注",path:"remark"},{default:n(()=>[e(c,{value:a.remark,"onUpdate:value":t[10]||(t[10]=s=>a.remark=s),rows:3,type:"textarea",placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),We=j({name:"OssConfigSearch",__name:"oss-config-search",props:{model:{required:!0},modelModifiers:{}},emits:H(["reset","search"],["update:model"]),setup(p,{emit:R}){const u=R,{formRef:$,validate:v,restoreValidation:U}=Z(),d=E(p,"model"),I=ge([{label:"是",value:"0"},{label:"否",value:"1"}]);async function g(){await U(),u("reset")}async function O(){await v(),u("search")}return(a,f)=>{const N=L,C=he,P=J,B=se,x=X,t=le,b=ne,c=te,r=ee,K=be,S=ve,D=Y;return T(),M(D,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(S,null,{default:n(()=>[e(K,{title:l(h)("common.search"),name:"user-search"},{default:n(()=>[e(r,{ref_key:"formRef",ref:$,model:d.value,"label-placement":"left","label-width":80},{default:n(()=>[e(c,{responsive:"screen","item-responsive":""},{default:n(()=>[e(C,{span:"24 s:12 m:6",label:"配置名称",path:"configKey",class:"pr-24px"},{default:n(()=>[e(N,{value:d.value.configKey,"onUpdate:value":f[0]||(f[0]=o=>d.value.configKey=o),placeholder:"请输入配置名称"},null,8,["value"])]),_:1}),e(C,{span:"24 s:12 m:6",label:"桶名称",path:"bucketName",class:"pr-24px"},{default:n(()=>[e(N,{value:d.value.bucketName,"onUpdate:value":f[1]||(f[1]=o=>d.value.bucketName=o),placeholder:"请输入桶名称"},null,8,["value"])]),_:1}),e(C,{span:"24 s:12 m:6",label:"域",path:"region",class:"pr-24px"},{default:n(()=>[e(N,{value:d.value.region,"onUpdate:value":f[2]||(f[2]=o=>d.value.region=o),placeholder:"请输入域"},null,8,["value"])]),_:1}),e(C,{span:"24 s:12 m:6",label:"是否默认",path:"status",class:"pr-24px"},{default:n(()=>[e(P,{value:d.value.status,"onUpdate:value":f[3]||(f[3]=o=>d.value.status=o),placeholder:"请选择是否默认",options:I.value,clearable:""},null,8,["value","options"])]),_:1}),e(C,{span:"24",class:"pr-24px"},{default:n(()=>[e(b,{class:"w-full",justify:"end"},{default:n(()=>[e(x,{onClick:g},{icon:n(()=>[e(B,{class:"text-icon"})]),default:n(()=>[w(" "+W(l(h)("common.reset")),1)]),_:1}),e(x,{type:"primary",ghost:"",onClick:O},{icon:n(()=>[e(t,{class:"text-icon"})]),default:n(()=>[w(" "+W(l(h)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ge={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},et=j({name:"system_oss-config",__name:"index",setup(p){Ce("sys_yes_no");const R=ye(),{hasAuth:u}=ke(),{columns:$,columnChecks:v,data:U,getData:d,getDataByPage:I,loading:g,mobilePagination:O,searchParams:a,resetSearchParams:f}=we({apiFn:$e,apiParams:{pageNum:1,pageSize:10,configKey:null,bucketName:null,region:null,status:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:h("common.index"),align:"center",width:64},{key:"configKey",title:"配置名称",align:"center",minWidth:120},{key:"bucketName",title:"桶名称",align:"center",minWidth:120},{key:"endpoint",title:"访问站点",align:"center",minWidth:120},{key:"region",title:"域",align:"center",minWidth:120},{key:"accessPolicy",title:"桶权限类型",align:"center",minWidth:120,render(o){return o.accessPolicy==="0"?e(G,{type:"info"},{default:()=>[w("私有")]}):o.accessPolicy==="1"?e(G,{type:"success"},{default:()=>[w("公有")]}):o.accessPolicy==="2"?e(G,{type:"warning"},{default:()=>[w("自定义")]}):null}},{key:"status",title:"是否默认",align:"center",minWidth:120,render(o){return e(xe,{value:o.status,"onUpdate:value":i=>o.status=i,info:o.configKey,onSubmitted:(i,_)=>D(o,i,_)},null)}},{key:"remark",title:"备注",align:"center",minWidth:120},{key:"operate",title:h("common.operate"),align:"center",width:130,render:o=>{const i=()=>!u("system:ossConfig:edit")||!u("system:ossConfig:remove")?null:e(V,{vertical:!0},null),_=()=>u("system:ossConfig:edit")?e(q,{text:!0,type:"primary",icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:h("common.edit"),onClick:()=>S(o.ossConfigId)},null):null,y=()=>u("system:ossConfig:remove")?e(q,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:h("common.delete"),popconfirmContent:h("common.confirmDelete"),onPositiveClick:()=>K(o.ossConfigId)},null):null;return e("div",{class:"flex-center gap-8px"},[_(),i(),y()])}}]}),{drawerVisible:N,operateType:C,editingData:P,handleAdd:B,handleEdit:x,checkedRowKeys:t,onBatchDeleted:b,onDeleted:c}=Ne(U,d);async function r(){const{error:o}=await z(t.value);o||b()}async function K(o){const{error:i}=await z([o]);i||c()}async function S(o){x("ossConfigId",o)}async function D(o,i,_){var k;const{error:y}=await Ae({configKey:o.configKey,ossConfigId:o.ossConfigId,status:i});_(!y),y||((k=window.$message)==null||k.success("状态修改成功"),d())}return(o,i)=>{const _=ie,y=Re,k=Y;return T(),Q("div",Ge,[e(We,{model:l(a),"onUpdate:model":i[0]||(i[0]=m=>F(a)?a.value=m:null),onReset:l(f),onSearch:l(I)},null,8,["model","onReset","onSearch"]),e(k,{title:"OSS配置列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(_,{columns:l(v),"onUpdate:columns":i[1]||(i[1]=m=>F(v)?v.value=m:null),"disabled-delete":l(t).length===0,loading:l(g),"show-add":l(u)("system:ossConfig:add"),"show-delete":l(u)("system:ossConfig:remove"),"show-export":!1,onAdd:l(B),onDelete:r,onRefresh:l(d)},null,8,["columns","disabled-delete","loading","show-add","show-delete","onAdd","onRefresh"])]),default:n(()=>[e(y,{"checked-row-keys":l(t),"onUpdate:checkedRowKeys":i[2]||(i[2]=m=>F(t)?t.value=m:null),columns:l($),data:l(U),size:"small","flex-height":!l(R).isMobile,"scroll-x":962,loading:l(g),remote:"","row-key":m=>m.ossConfigId,pagination:l(O),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Fe,{visible:l(N),"onUpdate:visible":i[3]||(i[3]=m=>F(N)?N.value=m:null),"operate-type":l(C),"row-data":l(P),onSubmitted:l(I)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{et as default};
