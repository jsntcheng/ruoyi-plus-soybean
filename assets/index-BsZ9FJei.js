import{_ as fe,a as _e,b as ge}from"./round-refresh-B0IUvXWI.js";import{aR as Q,b as P,o as N,e as S,aj as Z,bC as ve,d as j,ak as q,r as W,al as ee,c as F,w as s,f as t,h as l,$ as z,v as ye,B as K,g as v,t as M,R as te,as as we,am as oe,bA as xe,bB as he,a3 as O,s as A,aa as be,_ as ke,a as Ne,ae as Te,u as Ce,I as $e,ac as Y,p as Se,i as Be,af as V,aU as Ue,bD as Re,bE as Pe,b0 as ze,ag as De,aq as Ie,A as X,G as Ae}from"./index-Z8DUt18u.js";import{_ as Le}from"./upload-rounded-B8lABAEC.js";import{e as Me,g as Ee}from"./config-w4KkYjGQ.js";import{u as Oe,a as Ve}from"./table-xLscuIQ4.js";import{_ as Fe,a as We,b as Ke,u as je}from"./auth-CEy-eMOu.js";import{u as qe}from"./download-4Fcgw4rI.js";import{u as He,b as Ge}from"./form-34oM_FHm.js";import{_ as Je}from"./Grid-tUpxGiRj.js";import{_ as Ye}from"./DatePicker-CLebrfbL.js";import{_ as Xe}from"./Space-CCrTpFrl.js";import{_ as Qe,a as Ze,N as et}from"./Upload-ebcPdg_J.js";import{_ as tt,a as ot}from"./text-CBo7gPAZ.js";import{_ as nt}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./index-DbR6TmJ_.js";import"./_createCompounder-DoywBD48.js";const st={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function at(m,f){return N(),P("svg",st,f[0]||(f[0]=[S("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",color:"currentColor"},[S("path",{d:"M2.256 15.632c.034-.323.268-.583.736-1.104l1.031-1.153c.252-.32.431-.875.431-1.375s-.179-1.056-.43-1.375L2.991 9.472c-.468-.52-.702-.781-.736-1.104s.14-.627.49-1.234l.494-.857c.373-.648.56-.972.878-1.1c.317-.13.676-.028 1.395.176l1.22.343c.459.106.94.046 1.358-.169l.337-.194a2 2 0 0 0 .788-.968l.334-.997c.22-.66.33-.99.591-1.18C10.403 2 10.75 2 11.444 2h1.115c.694 0 1.042 0 1.303.189s.371.519.59 1.179l.335.997a2 2 0 0 0 .788.968l.337.194c.418.215.9.275 1.358.17l1.22-.344c.719-.204 1.078-.306 1.395-.177c.318.13.505.453.878 1.101l.493.857c.35.607.525.91.491 1.234s-.268.583-.736 1.104l-1.031 1.153c-.252.319-.431.875-.431 1.375s.179 1.056.43 1.375l1.032 1.153c.468.52.702.781.736 1.104s-.14.627-.49 1.234l-.494.857c-.373.648-.56.972-.878 1.1c-.317.13-.676.028-1.395-.176l-1.22-.343a2 2 0 0 0-1.359.169l-.336.194c-.36.23-.636.57-.788.968l-.334.997c-.22.66-.33.99-.591 1.18c-.261.188-.609.188-1.303.188h-1.115c-.694 0-1.041 0-1.303-.189c-.261-.189-.371-.518-.59-1.178"}),S("path",{d:"M2.737 18.78c1.08-1.08 4.752-4.716 5.112-5.136c.381-.444.072-1.044.256-2.904c.089-.9.282-1.574.836-2.076c.66-.624 1.2-.624 3.06-.666c1.62.042 1.812-.138 1.98.282c.12.3-.24.48-.672.96c-.96.96-1.524 1.44-1.578 1.74c-.39 1.32 1.146 2.1 1.986 1.26c.318-.318 1.788-1.8 1.932-1.92c.108-.096.367-.092.492.06c.108.106.12.12.108.6c-.01.444-.006 1.082-.004 1.74c.001.852-.044 1.8-.404 2.28c-.72 1.08-1.92 1.14-3 1.188c-1.02.06-1.86-.048-2.124.144c-.216.108-1.356 1.308-2.736 2.688l-2.46 2.46c-2.04 1.62-4.284-.9-2.784-2.7"})],-1)]))}const lt=Q({name:"hugeicons-configuration01",render:at}),it={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function rt(m,f){return N(),P("svg",it,f[0]||(f[0]=[S("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zm1-2h12l-3.75-5l-3 4L9 13zm-1 2V5z"},null,-1)]))}const ut=Q({name:"material-symbols-image-outline",render:rt});function pt(m){return Z({url:"/resource/oss/list",method:"get",params:m})}function H(m){return Z({url:`/resource/oss/${m.join(",")}`,method:"delete"})}const{copy:dt,isSupported:ct}=ve();async function mt(m){var f,i;if(!ct){(f=window.$message)==null||f.error("您的浏览器不支持 Clipboard API");return}if(m){if(navigator.clipboard&&window.isSecureContext)await dt(m);else{const B=document.createRange();B.selectNode(document.getElementById("tokenDetailInput"));const c=window.getSelection();c!=null&&c.rangeCount&&c.removeAllRanges(),c==null||c.addRange(B),document.execCommand("copy")}(i=window.$message)==null||i.success("复制成功")}}const ft=j({name:"OssSearch",__name:"oss-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(m,{emit:f}){const i=f,{formRef:B,validate:c,restoreValidation:g}=He(),_=W(null),r=ee(m,"model");async function D(){_.value=null,await g(),i("reset")}async function T(){var C;await c(),(C=_.value)!=null&&C.length&&(r.value.params.beginCreateTime=_.value[0],r.value.params.endCreateTime=_.value[1]),i("search")}return(C,u)=>{const U=ye,R=Ke,I=Ye,o=fe,e=K,p=_e,y=Xe,w=Je,d=Ge,$=We,x=Fe,h=te;return N(),F(h,{bordered:!1,size:"small",class:"card-wrapper"},{default:s(()=>[t(x,null,{default:s(()=>[t($,{title:l(z)("common.search"),name:"user-search"},{default:s(()=>[t(d,{ref_key:"formRef",ref:B,model:r.value,"label-placement":"left","label-width":100},{default:s(()=>[t(w,{responsive:"screen","item-responsive":""},{default:s(()=>[t(R,{span:"24 s:12 m:6",label:"文件名",path:"fileName",class:"pr-24px"},{default:s(()=>[t(U,{value:r.value.fileName,"onUpdate:value":u[0]||(u[0]=b=>r.value.fileName=b),placeholder:"请输入文件名"},null,8,["value"])]),_:1}),t(R,{span:"24 s:12 m:6",label:"原名",path:"originalName",class:"pr-24px"},{default:s(()=>[t(U,{value:r.value.originalName,"onUpdate:value":u[1]||(u[1]=b=>r.value.originalName=b),placeholder:"请输入原名"},null,8,["value"])]),_:1}),t(R,{span:"24 s:12 m:6",label:"文件后缀名",path:"fileSuffix",class:"pr-24px"},{default:s(()=>[t(U,{value:r.value.fileSuffix,"onUpdate:value":u[2]||(u[2]=b=>r.value.fileSuffix=b),placeholder:"请输入文件后缀名"},null,8,["value"])]),_:1}),t(R,{span:"24 s:12 m:6",label:"服务商",path:"service",class:"pr-24px"},{default:s(()=>[t(U,{value:r.value.service,"onUpdate:value":u[3]||(u[3]=b=>r.value.service=b),placeholder:"请输入服务商"},null,8,["value"])]),_:1}),t(R,{span:"24 s:12 m:12",label:"创建时间",path:"createTime",class:"pr-24px"},{default:s(()=>[t(I,{"formatted-value":_.value,"onUpdate:formattedValue":u[4]||(u[4]=b=>_.value=b),type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss",clearable:""},null,8,["formatted-value"])]),_:1}),t(R,{span:"24 s:12 m:12",class:"pr-24px"},{default:s(()=>[t(y,{class:"w-full",justify:"end"},{default:s(()=>[t(e,{onClick:D},{icon:s(()=>[t(o,{class:"text-icon"})]),default:s(()=>[v(" "+M(l(z)("common.reset")),1)]),_:1}),t(e,{type:"primary",ghost:"",onClick:T},{icon:s(()=>[t(p,{class:"text-icon"})]),default:s(()=>[v(" "+M(l(z)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),_t={DEV:!1,VITE_APP_BASE_API:"/prod-api",VITE_APP_WEBSOCKET:"N",VITE_HTTP_PROXY:"Y"},gt={class:"mb-12px flex-center"},vt={class:"text-red-500"},yt={class:"text-red-500"},wt={class:"text-red-500"},xt={class:"text-red-500"},ht=j({name:"FileUpload",__name:"file-upload",props:{action:{default:"/resource/oss/upload"},data:{default:void 0},defaultUpload:{type:Boolean,default:!0},showTip:{type:Boolean,default:!0},max:{default:5},accept:{default:".doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.pdf"},fileSize:{default:5},uploadType:{default:"file"}},setup(m,{expose:f}){const i=m,B=we();let c=0;const g=W([]),_=W(!1);f({needRelaodData:_}),oe(()=>g.value,o=>{_.value=o.length>0});const r=!1,{baseURL:D}=xe(_t,r),T={Authorization:`Bearer ${he()}`,clientid:"e5cd7e4891bf95d1d19206ce24a7b32e"};function C(o){var p,y,w,d,$,x;c+=1;const{file:e}=o;if(i.accept){const h=e.name.split("."),b=`.${h[h.length-1]}`;if(!((p=i.accept.split(","))==null?void 0:p.includes(b)))return(y=window.$message)==null||y.error(`文件格式不正确, 请上传 ${i.accept} 格式文件!`),!1}return e.name.includes(",")?((w=window.$message)==null||w.error("文件名不正确，不能包含英文逗号!"),!1):i.fileSize&&((d=e.file)!=null&&d.size)&&!((($=e.file)==null?void 0:$.size)/1024/1024<i.fileSize)?((x=window.$message)==null||x.error(`上传文件大小不能超过 ${i.fileSize} MB!`),!1):!0}function u(o){const e=o==null?void 0:o.responseText;return JSON.parse(e).code!==200}function U(o){var $,x;c-=1;const{file:e,event:p}=o,y=($=p==null?void 0:p.target)==null?void 0:$.responseText,d=JSON.parse(y).data;return g.value.find(h=>h.id===e.id).id=String(d.ossId),e.id=String(d.ossId),e.url=d.url,e.name=d.fileName,c===0&&((x=window.$message)==null||x.success("上传成功")),e}function R(o){var w,d;const{event:e}=o,p=(w=e==null?void 0:e.target)==null?void 0:w.responseText,y=JSON.parse(p).msg;(d=window.$message)==null||d.error(y||"上传失败")}async function I(o){var p;if(o.status!=="finished")return;const{error:e}=await H([o.id]);e||(p=window.$message)==null||p.success("删除成功")}return(o,e)=>{const p=ke,y=tt,w=ot,d=Ze,$=Qe;return N(),P(O,null,[t($,be(l(B),{"file-list":g.value,"onUpdate:fileList":e[0]||(e[0]=x=>g.value=x),action:`${l(D)}${o.action}`,data:o.data,headers:T,max:o.max,accept:o.accept,multiple:o.max>1,"directory-dnd":"","default-upload":o.defaultUpload,"list-type":o.uploadType==="image"?"image-card":"text","is-error-state":u,onFinish:U,onError:R,onBeforeUpload:C,onRemove:e[1]||(e[1]=({file:x})=>I(x))}),{default:s(()=>[o.uploadType==="file"?(N(),F(d,{key:0},{default:s(()=>[S("div",gt,[t(p,{icon:"material-symbols:unarchive-outline",class:"text-58px color-#d8d8db dark:color-#a1a1a2"})]),t(y,{class:"text-16px"},{default:s(()=>e[2]||(e[2]=[v("点击或者拖动文件到该区域来上传")])),_:1}),o.showTip?(N(),F(w,{key:0,depth:"3",class:"mt-8px text-center"},{default:s(()=>[e[5]||(e[5]=v(" 请上传 ")),o.fileSize?(N(),P(O,{key:0},[e[3]||(e[3]=v(" 大小不超过 ")),S("b",vt,M(o.fileSize)+"MB",1)],64)):A("",!0),o.accept?(N(),P(O,{key:1},[e[4]||(e[4]=v(" ，且格式为 ")),S("b",yt,M(o.accept.replaceAll(",","/")),1)],64)):A("",!0),e[6]||(e[6]=v(" 的文件 "))]),_:1})):A("",!0)]),_:1})):A("",!0)]),_:1},16,["file-list","action","data","max","accept","multiple","default-upload","list-type"]),o.showTip&&o.uploadType==="image"?(N(),F(w,{key:0,depth:"3",class:"mt-12px"},{default:s(()=>[e[9]||(e[9]=v(" 请上传 ")),o.fileSize?(N(),P(O,{key:0},[e[7]||(e[7]=v(" 大小不超过 ")),S("b",wt,M(o.fileSize)+"MB",1)],64)):A("",!0),o.accept?(N(),P(O,{key:1},[e[8]||(e[8]=v(" ，且格式为 ")),S("b",xt,M(o.accept.replaceAll(",","/")),1)],64)):A("",!0),e[10]||(e[10]=v(" 的文件 "))]),_:1})):A("",!0)],64)}}}),bt=j({name:"OssUploadModal",__name:"oss-upload-modal",props:q({uploadType:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["close"],["update:visible"]),setup(m,{emit:f}){const i=W(null),B=m,c=f,g=ee(m,"visible"),_=Ne(()=>B.uploadType==="file"?".doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.pdf":".jpg,.jpeg,.png,.gif,.bmp,.webp");function r(){g.value=!1}function D(){var T;r(),(T=i.value)!=null&&T.needRelaodData&&c("close")}return oe(g,()=>{g.value}),(T,C)=>{const u=Te;return N(),F(u,{show:g.value,"onUpdate:show":C[0]||(C[0]=U=>g.value=U),class:"max-h-520px max-w-90% w-600px",preset:"card",title:`上传${T.uploadType==="file"?"文件":"图片"}`,size:"huge",bordered:!1,onAfterLeave:D},{default:s(()=>[t(ht,{ref_key:"fileUploadRef",ref:i,"upload-type":T.uploadType,accept:_.value},null,8,["upload-type","accept"])]),_:1},8,["show","title"])}}}),kt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Nt=j({name:"system_oss",__name:"index",setup(m){const{routerPushByKey:f}=Ce(),{hasAuth:i}=je(),{oss:B}=qe(),c=$e(),g=W("file"),{bool:_,setBool:r}=Y(!0),{loading:D,startLoading:T,endLoading:C}=Se(!1),{bool:u,setTrue:U}=Y(!1),{columns:R,columnChecks:I,data:o,getData:e,getDataByPage:p,loading:y,mobilePagination:w,searchParams:d,resetSearchParams:$}=Oe({apiFn:pt,apiParams:{pageNum:1,pageSize:10,fileName:null,originalName:null,fileSuffix:null,service:null,params:{}},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:z("common.index"),align:"center",width:64},{key:"ossId",title:"对象存储主键",align:"center",minWidth:120},{key:"fileName",title:"文件名",align:"center",ellipsis:{tooltip:!0,lineClamp:3},minWidth:120},{key:"originalName",title:"原名",align:"center",ellipsis:{tooltip:!0,lineClamp:3},minWidth:120},{key:"fileSuffix",title:"文件后缀名",align:"center",minWidth:100},{key:"url",title:"URL地址",align:"center",minWidth:120,render:a=>_.value&&Re(a.fileSuffix)?t(et,{class:"h-40px w-40px object-contain",src:a.url},null):t(ze,null,{default:()=>t("span",null,[v("点击复制")]),trigger:()=>t("div",{class:"cursor-pointer",onClick:async()=>await mt(a.url)},[t(Pe,{"line-clamp":3,tooltip:!1},{default:()=>[a.url]})])})},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"createByName",title:"上传人",align:"center",minWidth:120},{key:"service",title:"服务商",align:"center",minWidth:100,render:a=>t(De,{type:"primary"},{default:()=>[a.service]})},{key:"operate",title:z("common.operate"),align:"center",width:130,render:a=>{const n=()=>!i("system:oss:download")||!i("system:oss:delete")?null:t(Ie,{vertical:!0},null),E=()=>i("system:oss:download")?t(X,{text:!0,type:"primary",icon:"material-symbols:download-rounded",class:"text-20px",tooltipContent:z("common.download"),onClick:()=>ae(a.ossId)},null):null,L=()=>i("system:oss:delete")?t(X,{text:!0,type:"error",icon:"material-symbols:delete-outline",class:"text-20px",tooltipContent:z("common.delete"),popconfirmContent:z("common.confirmDelete"),onPositiveClick:()=>se(a.ossId)},null):null;return t("div",{class:"flex-center gap-8px"},[E(),n(),L()])}}]}),{handleAdd:x,checkedRowKeys:h,onBatchDeleted:b,onDeleted:G}=Ve(o,e);async function ne(){const{error:a}=await H(h.value);a||b()}async function se(a){const{error:n}=await H([a]);n||G()}function ae(a){B(a)}function J(a){g.value=a,U()}async function le(){const{data:a,error:n}=await Me("sys.oss.previewListResource");n||r(a==="true")}Be(()=>{le()});async function ie(a){var n;r(!a),(n=window.$dialog)==null||n.warning({title:"提示",content:`是否确认${a?"开启":"关闭"}预览？`,positiveText:"确认",negativeText:"取消",onPositiveClick:async()=>{var L;T();const{error:E}=await Ee({configKey:"sys.oss.previewListResource",configValue:String(a)});if(E){r(!a),C();return}r(a),(L=window.$message)==null||L.success("更新成功"),C()},onNegativeClick:()=>{r(!a)}})}function re(){f("system_oss-config")}return(a,n)=>{const E=Ue,L=Le,ue=ut,pe=lt,de=ge,ce=nt,me=te;return N(),P("div",kt,[t(ft,{model:l(d),"onUpdate:model":n[0]||(n[0]=k=>V(d)?d.value=k:null),onReset:l($),onSearch:l(p)},null,8,["model","onReset","onSearch"]),t(me,{title:"OSS 对象存储列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":s(()=>[t(de,{columns:l(I),"onUpdate:columns":n[4]||(n[4]=k=>V(I)?I.value=k:null),"disabled-delete":l(h).length===0,loading:l(y),"show-add":!1,"show-delete":l(i)("system:oss:delete"),onAdd:l(x),onDelete:ne,onRefresh:l(e)},{prefix:s(()=>[t(E,{value:l(_),"onUpdate:value":[n[1]||(n[1]=k=>V(_)?_.value=k:null),ie],class:"mt-1px",loading:l(D),size:"large",round:!1},{checked:s(()=>n[7]||(n[7]=[S("span",{class:"text-14px"},"禁用预览",-1)])),unchecked:s(()=>n[8]||(n[8]=[S("span",{class:"text-14px"},"开启预览",-1)])),_:1},8,["value","loading"]),t(l(K),{size:"small",ghost:"",onClick:n[2]||(n[2]=k=>J("file"))},{icon:s(()=>[t(L)]),default:s(()=>[n[9]||(n[9]=v(" 上传文件 "))]),_:1}),t(l(K),{size:"small",ghost:"",onClick:n[3]||(n[3]=k=>J("image"))},{icon:s(()=>[t(ue)]),default:s(()=>[n[10]||(n[10]=v(" 上传图片 "))]),_:1}),t(l(K),{type:"primary",size:"small",ghost:"",onClick:re},{icon:s(()=>[t(pe)]),default:s(()=>[n[11]||(n[11]=v(" 配置管理 "))]),_:1})]),_:1},8,["columns","disabled-delete","loading","show-delete","onAdd","onRefresh"])]),default:s(()=>[t(ce,{"checked-row-keys":l(h),"onUpdate:checkedRowKeys":n[5]||(n[5]=k=>V(h)?h.value=k:null),columns:l(R),data:l(o),size:"small","flex-height":!l(c).isMobile,"scroll-x":962,loading:l(y),remote:"","row-key":k=>k.ossId,pagination:l(w),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(bt,{visible:l(u),"onUpdate:visible":n[6]||(n[6]=k=>V(u)?u.value=k:null),"upload-type":g.value,onClose:l(e)},null,8,["visible","upload-type","onClose"])]),_:1})])}}}),Ft=Ae(Nt,[["__scopeId","data-v-476592d5"]]);export{Ft as default};
