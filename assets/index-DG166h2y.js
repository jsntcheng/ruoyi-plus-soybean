import{_ as pe,a as ce,b as me}from"./round-refresh-B0IUvXWI.js";import{_ as _e}from"./sync-outline-D6YRK7Vj.js";import{d as Q,ak as J,al as ee,p as fe,a as te,q as ve,r as ge,am as ye,c as X,o as E,w as a,f as e,an as be,b as ae,s as ne,aq as oe,g as k,v as le,N as he,h as s,ao as we,e as q,bk as Ne,B as Y,t as j,$ as h,ap as ke,bF as xe,bG as Ue,R as se,I as Te,n as Ie,af as H,bH as Z,bI as Ce,bJ as De,a3 as Pe,A as K,bK as Se}from"./index-Z8DUt18u.js";import{_ as $e,a as Be,b as Re,u as Fe}from"./auth-CEy-eMOu.js";import{u as Ae,a as Le}from"./table-xLscuIQ4.js";import{u as Me}from"./download-4Fcgw4rI.js";import{u as Ve}from"./dict-D3hWHJVt.js";import{_ as ze}from"./dict-tag.vue_vue_type_script_setup_true_lang-C3NRfqiy.js";import{_ as Ge}from"./dict-radio.vue_vue_type_script_setup_true_lang-Chn5U5qK.js";import{_ as Oe}from"./form-tip.vue_vue_type_script_setup_true_lang-8erTB2XS.js";import{e as We}from"./tenant-package-DVl4jZkt.js";import{u as re,a as Ee,b as ie,_ as qe}from"./form-34oM_FHm.js";import{_ as He}from"./DatePicker-CLebrfbL.js";import{_ as je}from"./InputGroupLabel-CQEnIkbr.js";import{_ as ue}from"./Space-CCrTpFrl.js";import{_ as Ke}from"./Grid-tUpxGiRj.js";import{_ as Je}from"./DataTable-s6EYq0ve.js";import"./use-table-DjHicHPt.js";import"./dict-CTAJ1fRb.js";import"./index-DbR6TmJ_.js";const Qe={key:0},Xe={class:"flex-center"},Ye={class:"flex-center"},Ze=Q({name:"TenantOperateDrawer",__name:"tenant-operate-drawer",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(F,{emit:A}){const c=F,w=A,x=ee(F,"visible"),{formRef:L,validate:m,restoreValidation:P}=re(),{createRequiredRule:_,patternRules:S}=Ee(),{loading:f,startLoading:U,endLoading:T}=fe(),I=te(()=>({add:"新增租户",edit:"编辑租户"})[c.operateType]),n=ve(D());function D(){return{tenantId:"",contactUserName:"",contactPhone:"",companyName:"",licenseNumber:"",address:"",intro:"",domain:"",remark:"",packageId:null,expireTime:null,accountCount:null,status:"0",username:"",password:""}}const M={id:_("id不能为空"),contactUserName:_("联系人不能为空"),contactPhone:[_("联系电话不能为空"),{...S.phone,trigger:["blur","change"]}],companyName:_("企业名称不能为空"),packageId:_("租户套餐不能为空"),accountCount:_("用户数量不能为空"),username:[_("管理员账号不能为空"),{min:2,max:20,message:"账号长度必须介于2-20之间",trigger:["blur","change"]}],password:[_("管理员密码不能为空"),{min:5,max:20,message:"密码长度必须介于5-20之间",trigger:["blur","change"]}]},R=ge([]);async function V(){U();const{error:d,data:t}=await We();d||(R.value=t.map(v=>({label:v.packageName,value:v.packageId}))),T()}function z(){if(c.operateType==="add"){Object.assign(n,D());return}c.operateType==="edit"&&c.rowData&&Object.assign(n,c.rowData)}function N(){x.value=!1}async function G(){var d;if(await m(),c.operateType==="add"){const{contactUserName:t,contactPhone:v,companyName:p,licenseNumber:i,address:$,intro:B,domain:o,remark:r,packageId:b,expireTime:g,accountCount:y,status:C,username:u,password:O}=n,{error:W}=await xe({contactUserName:t,contactPhone:v,companyName:p,username:u,password:O,licenseNumber:i,address:$,intro:B,domain:o,remark:r,packageId:b,expireTime:g,accountCount:y,status:C});if(W)return}if(c.operateType==="edit"){const{id:t,tenantId:v,contactUserName:p,contactPhone:i,companyName:$,licenseNumber:B,address:o,intro:r,domain:b,remark:g,packageId:y,expireTime:C,accountCount:u,status:O}=n,{error:W}=await Ue({id:t,tenantId:v,contactUserName:p,contactPhone:i,companyName:$,licenseNumber:B,address:o,intro:r,domain:b,remark:g,packageId:y,expireTime:C,accountCount:u,status:O});if(W)return}(d=window.$message)==null||d.success(h("common.updateSuccess")),N(),w("submitted")}return ye(x,()=>{x.value&&(V(),z(),P())}),(d,t)=>{const v=oe,p=le,i=qe,$=he,B=He,o=Oe,r=we,b=je,g=Ne,y=Ge,C=ie,u=Y,O=ue,W=be,de=ke;return E(),X(de,{show:x.value,"onUpdate:show":t[14]||(t[14]=l=>x.value=l),title:I.value,"display-directive":"show",width:800,class:"max-w-90%"},{default:a(()=>[e(W,{title:I.value,"native-scrollbar":!1,closable:""},{footer:a(()=>[e(O,{size:16},{default:a(()=>[e(u,{onClick:N},{default:a(()=>[k(j(s(h)("common.cancel")),1)]),_:1}),e(u,{type:"primary",onClick:G},{default:a(()=>[k(j(s(h)("common.confirm")),1)]),_:1})]),_:1})]),default:a(()=>[e(C,{ref_key:"formRef",ref:L,model:n,rules:M},{default:a(()=>[e(v,null,{default:a(()=>t[15]||(t[15]=[k("基本信息")])),_:1}),e(i,{label:"企业名称",path:"companyName"},{default:a(()=>[e(p,{value:n.companyName,"onUpdate:value":t[0]||(t[0]=l=>n.companyName=l),placeholder:"请输入企业名称"},null,8,["value"])]),_:1}),e(i,{label:"联系人",path:"contactUserName"},{default:a(()=>[e(p,{value:n.contactUserName,"onUpdate:value":t[1]||(t[1]=l=>n.contactUserName=l),placeholder:"请输入联系人"},null,8,["value"])]),_:1}),e(i,{label:"联系电话",path:"contactPhone"},{default:a(()=>[e(p,{value:n.contactPhone,"onUpdate:value":t[2]||(t[2]=l=>n.contactPhone=l),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),c.operateType==="add"?(E(),ae("div",Qe,[e(v,null,{default:a(()=>t[16]||(t[16]=[k("管理员信息")])),_:1}),e(i,{label:"管理员账号",path:"username"},{default:a(()=>[e(p,{value:n.username,"onUpdate:value":t[3]||(t[3]=l=>n.username=l),placeholder:"请输入管理员账号"},null,8,["value"])]),_:1}),e(i,{label:"管理员密码",path:"password"},{default:a(()=>[e(p,{value:n.password,"onUpdate:value":t[4]||(t[4]=l=>n.password=l),type:"password","show-password-on":"click",placeholder:"请输入管理员密码"},null,8,["value"])]),_:1})])):ne("",!0),e(v,null,{default:a(()=>t[17]||(t[17]=[k("租户设置")])),_:1}),e(i,{label:"租户套餐",path:"packageId"},{default:a(()=>[e($,{value:n.packageId,"onUpdate:value":t[5]||(t[5]=l=>n.packageId=l),clearable:"",disabled:c.operateType==="edit",placeholder:"请选择租户套餐",options:R.value,loading:s(f)},null,8,["value","disabled","options","loading"])]),_:1}),e(i,{label:"过期时间",path:"expireTime"},{default:a(()=>[e(B,{"formatted-value":n.expireTime,"onUpdate:formattedValue":t[6]||(t[6]=l=>n.expireTime=l),type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",clearable:"",class:"w-full"},null,8,["formatted-value"])]),_:1}),e(i,{path:"accountCount"},{label:a(()=>[q("div",Xe,[e(o,{content:"-1不限制用户数量"}),t[18]||(t[18]=q("span",null,"用户数量",-1))])]),default:a(()=>[e(r,{value:n.accountCount,"onUpdate:value":t[7]||(t[7]=l=>n.accountCount=l),placeholder:"请输入用户数量",min:"-1",class:"w-full"},null,8,["value"])]),_:1}),e(i,{path:"domain"},{label:a(()=>[q("div",Ye,[e(o,{content:"可填写域名/端口 填写域名如: www.test.com 或者 www.test.com:8080 填写ip:端口如: 127.0.0.1:8080"}),t[19]||(t[19]=q("span",null,"绑定域名",-1))])]),default:a(()=>[e(g,null,{default:a(()=>[e(b,null,{default:a(()=>t[20]||(t[20]=[k("http(s)://")])),_:1}),e(p,{value:n.domain,"onUpdate:value":t[8]||(t[8]=l=>n.domain=l),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(i,{label:"租户状态",path:"status"},{default:a(()=>[e(y,{value:n.status,"onUpdate:value":t[9]||(t[9]=l=>n.status=l),"dict-code":"sys_normal_disable"},null,8,["value"])]),_:1}),e(v,null,{default:a(()=>t[21]||(t[21]=[k("企业信息")])),_:1}),e(i,{label:"企业地址",path:"address"},{default:a(()=>[e(p,{value:n.address,"onUpdate:value":t[10]||(t[10]=l=>n.address=l),placeholder:"请输入企业地址"},null,8,["value"])]),_:1}),e(i,{label:"企业代码",path:"licenseNumber"},{default:a(()=>[e(p,{value:n.licenseNumber,"onUpdate:value":t[11]||(t[11]=l=>n.licenseNumber=l),placeholder:"请输入企业代码"},null,8,["value"])]),_:1}),e(i,{label:"企业简介",path:"intro"},{default:a(()=>[e(p,{value:n.intro,"onUpdate:value":t[12]||(t[12]=l=>n.intro=l),type:"textarea",placeholder:"请输入企业简介"},null,8,["value"])]),_:1}),e(i,{label:"备注",path:"remark"},{default:a(()=>[e(p,{value:n.remark,"onUpdate:value":t[13]||(t[13]=l=>n.remark=l),type:"textarea",placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show","title"])}}}),et=Q({name:"TenantSearch",__name:"tenant-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search"],["update:model"]),setup(F,{emit:A}){const c=A,{formRef:w,validate:x,restoreValidation:L}=re(),m=ee(F,"model");async function P(){await L(),c("reset")}async function _(){await x(),c("search")}return(S,f)=>{const U=le,T=Re,I=pe,n=Y,D=ce,M=ue,R=Ke,V=ie,z=Be,N=$e,G=se;return E(),X(G,{bordered:!1,size:"small",class:"card-wrapper"},{default:a(()=>[e(N,null,{default:a(()=>[e(z,{title:s(h)("common.search"),name:"user-search"},{default:a(()=>[e(V,{ref_key:"formRef",ref:w,model:m.value,"label-placement":"left","label-width":80},{default:a(()=>[e(R,{responsive:"screen","item-responsive":""},{default:a(()=>[e(T,{span:"24 s:12 m:6",label:"租户编号",path:"tenantId",class:"pr-24px"},{default:a(()=>[e(U,{value:m.value.tenantId,"onUpdate:value":f[0]||(f[0]=d=>m.value.tenantId=d),placeholder:"请输入租户编号"},null,8,["value"])]),_:1}),e(T,{span:"24 s:12 m:6",label:"联系人",path:"contactUserName",class:"pr-24px"},{default:a(()=>[e(U,{value:m.value.contactUserName,"onUpdate:value":f[1]||(f[1]=d=>m.value.contactUserName=d),placeholder:"请输入联系人"},null,8,["value"])]),_:1}),e(T,{span:"24 s:12 m:6",label:"联系电话",path:"contactPhone",class:"pr-24px"},{default:a(()=>[e(U,{value:m.value.contactPhone,"onUpdate:value":f[2]||(f[2]=d=>m.value.contactPhone=d),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),e(T,{span:"24 s:12 m:6",label:"企业名称",path:"companyName",class:"pr-24px"},{default:a(()=>[e(U,{value:m.value.companyName,"onUpdate:value":f[3]||(f[3]=d=>m.value.companyName=d),placeholder:"请输入企业名称"},null,8,["value"])]),_:1}),e(T,{span:"24",class:"pr-24px"},{default:a(()=>[e(M,{class:"w-full",justify:"end"},{default:a(()=>[e(n,{onClick:P},{icon:a(()=>[e(I,{class:"text-icon"})]),default:a(()=>[k(" "+j(s(h)("common.reset")),1)]),_:1}),e(n,{type:"primary",ghost:"",onClick:_},{icon:a(()=>[e(D,{class:"text-icon"})]),default:a(()=>[k(" "+j(s(h)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),tt={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},Nt=Q({name:"system_tenant",__name:"index",setup(F){Ve("sys_normal_disable");const A=Te(),{download:c}=Me(),{hasAuth:w}=Fe(),{userInfo:x}=Ie(),L=te(()=>{var o;return((o=x.user)==null?void 0:o.userId)===1}),{columns:m,columnChecks:P,data:_,getData:S,getDataByPage:f,loading:U,mobilePagination:T,searchParams:I,resetSearchParams:n}=Ae({apiFn:De,apiParams:{pageNum:1,pageSize:10,tenantId:null,contactUserName:null,contactPhone:null,companyName:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:h("common.index"),align:"center",width:64},{key:"tenantId",title:"租户编号",align:"center",minWidth:80},{key:"contactUserName",title:"联系人",align:"center",minWidth:80},{key:"contactPhone",title:"联系电话",align:"center",minWidth:120},{key:"companyName",title:"企业名称",align:"center",minWidth:120},{key:"expireTime",title:"过期时间",align:"center",minWidth:120},{key:"status",title:"租户状态",align:"center",minWidth:120,render(o){return e(ze,{size:"small",value:o.status,dictCode:"sys_normal_disable"},null)}},{key:"operate",title:h("common.operate"),align:"center",width:180,render:o=>{if(o.tenantId==="000000")return null;const r=()=>e(K,{type:"primary",text:!0,icon:"material-symbols:drive-file-rename-outline-outline",tooltipContent:h("common.edit"),onClick:()=>p(o.id)},null),b=()=>e(K,{text:!0,type:"primary",icon:"material-symbols:sync-outline",tooltipContent:"同步套餐",popconfirmContent:`确认同步[${o.companyName}]的套餐吗?`,onPositiveClick:()=>$(o)},null),g=()=>e(K,{text:!0,type:"error",icon:"material-symbols:delete-outline",tooltipContent:h("common.delete"),popconfirmContent:h("common.confirmDelete"),onPositiveClick:()=>v(o.id)},null),y=[];return w("system:tenant:edit")&&y.push(r()),w("system:tenant:edit")&&y.push(b()),w("system:tenant:delete")&&y.push(g()),e("div",{class:"flex-center gap-8px"},[y.map((C,u)=>e(Pe,null,[u!==0&&e(oe,{vertical:!0},null),C]))])}}]}),{drawerVisible:D,operateType:M,editingData:R,handleAdd:V,handleEdit:z,checkedRowKeys:N,onBatchDeleted:G,onDeleted:d}=Le(_,S);async function t(){const{error:o}=await Z(N.value);o||G()}async function v(o){const{error:r}=await Z([o]);r||d()}async function p(o){z("id",o)}async function i(){var r;const{error:o}=await Ce();o||((r=window.$message)==null||r.success("同步租户字典成功"),await S())}async function $(o){var g;const r={tenantId:o.tenantId,packageId:o.packageId},{error:b}=await Se(r);b||((g=window.$message)==null||g.success("同步租户套餐成功"),await S())}async function B(){c("/system/tenant/export",I,`租户列表_${new Date().getTime()}.xlsx`)}return(o,r)=>{const b=_e,g=me,y=Je,C=se;return E(),ae("div",tt,[e(et,{model:s(I),"onUpdate:model":r[0]||(r[0]=u=>H(I)?I.value=u:null),onReset:s(n),onSearch:s(f)},null,8,["model","onReset","onSearch"]),e(C,{title:"租户列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":a(()=>[e(g,{columns:s(P),"onUpdate:columns":r[1]||(r[1]=u=>H(P)?P.value=u:null),"disabled-delete":s(N).length===0,loading:s(U),"show-add":s(w)("system:tenant:add"),"show-delete":s(w)("system:tenant:delete"),"show-export":s(w)("system:tenant:export"),onAdd:s(V),onDelete:t,onExport:B,onRefresh:s(S)},{prefix:a(()=>[L.value?(E(),X(s(Y),{key:0,ghost:"",size:"small",onClick:i},{icon:a(()=>[e(b)]),default:a(()=>[r[4]||(r[4]=k(" 同步租户字典 "))]),_:1})):ne("",!0)]),_:1},8,["columns","disabled-delete","loading","show-add","show-delete","show-export","onAdd","onRefresh"])]),default:a(()=>[e(y,{"checked-row-keys":s(N),"onUpdate:checkedRowKeys":r[2]||(r[2]=u=>H(N)?N.value=u:null),columns:s(m),data:s(_),size:"small","flex-height":!s(A).isMobile,"scroll-x":962,loading:s(U),remote:"","row-key":u=>u.id,pagination:s(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ze,{visible:s(D),"onUpdate:visible":r[3]||(r[3]=u=>H(D)?D.value=u:null),"operate-type":s(M),"row-data":s(R),onSubmitted:s(f)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Nt as default};
